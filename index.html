<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Municipality Services Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 15px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--secondary);
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        nav {
            width: 100%;
            order: 3;
            margin-top: 15px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background 0.3s;
            font-size: 0.9rem;
        }
        
        nav a:hover, nav a.active {
            background: var(--secondary);
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--accent);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            color: var(--primary);
        }
        
        .service-categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border-left: 4px solid var(--secondary);
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .category-icon {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .application-form {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* NEW STYLES FOR INFRASTRUCTURE MAPS */
        .infrastructure-section {
            margin-bottom: 30px;
        }
        
        .map-container {
            width: 100%;
            height: 400px;
            background-color: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
        }
        
        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            color: var(--primary);
        }
        
        .map-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .map-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .map-legend {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        .water-level-indicator {
            background: #3498db;
            height: 10px;
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }
        
        .water-level-fill {
            background: #1e6ea7;
            height: 100%;
            width: 0%;
            transition: width 1s ease;
        }
        
        .water-level-marks {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        .alert-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .alert-low {
            background: #d4edda;
            color: #155724;
        }
        
        .alert-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .alert-high {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* Interactive Map Styles */
        .interactive-map {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .map-background {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #a8d5e5 0%, #74b9ff 100%);
            position: relative;
        }
        
        .river {
            position: absolute;
            background: linear-gradient(to right, #3498db, #2980b9);
            border-radius: 10px;
        }
        
        .pipeline {
            position: absolute;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pipeline:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        
        .water-pipeline {
            background: linear-gradient(to right, #3498db, #2980b9);
        }
        
        .gas-pipeline {
            background: linear-gradient(to right, #e67e22, #d35400);
        }
        
        .pipeline-maintenance {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            animation: pulse 2s infinite;
        }
        
        .pipeline-safety-zone {
            background: linear-gradient(to right, #f39c12, #e67e22);
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .pipeline-info {
            position: absolute;
            background: white;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 10;
            display: none;
            max-width: 200px;
        }
        
        .pipeline-info h4 {
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .pipeline-info p {
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .map-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 5px;
            z-index: 5;
        }
        
        .map-overlay h3 {
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        /* Infrastructure Management Styles */
        .infrastructure-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .infrastructure-form {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .infrastructure-form h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .infrastructure-alerts {
            grid-column: 1 / -1;
        }
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .logo {
                justify-content: center;
                text-align: center;
            }
            
            .logo h1 {
                font-size: 1.5rem;
            }
            
            nav ul {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            nav a {
                padding: 10px 15px;
                width: 100%;
                text-align: center;
            }
            
            .user-actions {
                width: 100%;
                justify-content: center;
            }
            
            .service-categories {
                grid-template-columns: 1fr;
            }
            
            .map-container {
                height: 300px;
            }
            
            .infrastructure-management {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .header-content {
                flex-wrap: nowrap;
            }
            
            nav {
                width: auto;
                order: 2;
                margin-top: 0;
            }
            
            .user-actions {
                order: 3;
            }
            
            .service-categories {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .map-container {
                height: 400px;
            }
        }
        
        @media (min-width: 1025px) {
            .service-categories {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .map-container {
                height: 500px;
            }
        }
        
        /* Existing styles for other sections remain the same */
        .file-upload-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-container:hover {
            border-color: var(--secondary);
            background-color: #f8f9fa;
        }
        
        .file-upload-container i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .file-preview-item .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .application-list, .complaint-list {
            display: grid;
            gap: 15px;
        }
        
        .application-item, .complaint-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--secondary);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .application-info h3, .complaint-info h3 {
            margin-bottom: 5px;
        }
        
        .application-meta, .complaint-meta {
            display: flex;
            gap: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-in-progress {
            background: #cce7ff;
            color: #004085;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-resolved {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-open {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-investigation {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-closed {
            background: #d4edda;
            color: #155724;
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--secondary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
        }
        
        .chatbot-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            max-width: 90vw;
            height: 450px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chatbot-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
        }
        
        .bot-message {
            background: #f1f1f1;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .chatbot-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
        }
        
        .chatbot-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
        }
        
        .chatbot-input button {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }
        
        /* FIXED ADMIN PANEL STYLES */
        .admin-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            overflow: hidden;
        }
        
        .admin-sidebar {
            background: var(--primary);
            color: white;
            border-radius: 10px;
            padding: 20px;
            width: 100%;
        }
        
        .admin-sidebar ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .admin-sidebar li {
            flex: 1;
            min-width: 150px;
        }
        
        .admin-sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: background 0.3s;
            text-align: center;
        }
        
        .admin-sidebar a:hover, .admin-sidebar a.active {
            background: var(--secondary);
        }
        
        .admin-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            overflow-x: auto;
        }
        
        .admin-tab {
            display: none;
            width: 100%;
        }
        
        .admin-tab.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .edit-btn {
            background: var(--warning);
            color: white;
        }
        
        .delete-btn {
            background: var(--accent);
            color: white;
        }
        
        .view-btn {
            background: var(--secondary);
            color: white;
        }
        
        .canvas-container {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-top: 4px solid var(--secondary);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .documentation-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .documentation-info h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .documentation-info ul {
            padding-left: 20px;
        }
        
        .documentation-info li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            width: 100%;
            margin-top: 40px;
            color: #7f8c8d;
            border-top: 1px solid #eee;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1002;
            align-items: center;
            justify-content: center;
        }
        
        .login-form {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .login-form h2 {
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary);
        }
        
        .login-form .form-group {
            margin-bottom: 15px;
        }
        
        .admin-login-btn {
            background: var(--warning);
            color: white;
            margin-top: 10px;
        }
        
        .chatbot-quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .quick-action-btn {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .quick-action-btn:hover {
            background: #2980b9;
        }
        
        .service-steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .service-steps h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .service-steps ol {
            padding-left: 20px;
        }
        
        .service-steps li {
            margin-bottom: 5px;
        }
        
        .document-list {
            background: #fff3cd;
            border-radius: 5px;
            padding: 8px;
            margin: 5px 0;
        }
        
        .document-list ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .apply-now-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-title {
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .admin-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .complaint-categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .complaint-category {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--accent);
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .complaint-category:hover {
            transform: translateY(-5px);
        }
        
        .complaint-category h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .complaint-category p {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .complaint-form-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .complaint-details {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--warning);
        }
        
        .complaint-details h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .complaint-details p {
            margin-bottom: 8px;
        }
        
        .complaint-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* NEW STYLES FOR REGISTRATION FORM */
        .registration-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-full-width {
            grid-column: 1 / -1;
        }
        
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .admin-sidebar ul {
                flex-direction: column;
            }
            
            .admin-sidebar li {
                min-width: 100%;
            }
            
            .chart-row {
                grid-template-columns: 1fr;
            }
            
            .complaint-categories {
                grid-template-columns: 1fr;
            }
            
            .chatbot-window {
                width: 95vw;
                right: -10px;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .complaint-actions {
                flex-direction: column;
            }
            
            .application-item, .complaint-item {
                flex-direction: column;
            }
            
            .application-status, .complaint-status {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
            }
            
            .registration-form {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 769px) {
            .admin-panel {
                flex-direction: row;
            }
            
            .admin-sidebar {
                width: 250px;
            }
            
            .admin-sidebar ul {
                flex-direction: column;
            }
            
            .admin-sidebar li {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-city"></i>
                    <h1>Municipality Services Portal</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-section="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-section="services">Services</a></li>
                        <li><a href="#" class="nav-link" data-section="infrastructure">Infrastructure</a></li>
                        <li><a href="#" class="nav-link" data-section="complaints">File Complaint</a></li>
                        <li><a href="#" class="nav-link" data-section="my-applications">My Applications</a></li>
                        <li><a href="#" class="nav-link" data-section="my-complaints">My Complaints</a></li>
                        <li><a href="#" class="nav-link" data-section="documentation">Documentation</a></li>
                        <li><a href="#" class="nav-link" data-section="admin">Admin Panel</a></li>
                    </ul>
                </nav>
                <div class="user-actions">
                    <button class="btn btn-primary" id="loginBtn">Login</button>
                    <button class="btn btn-secondary" id="registerBtn">Register</button>
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="home" class="section active">
            <h2 class="section-title">Welcome to Municipality Services Portal</h2>
            <div class="canvas-container" id="animation-container"></div>
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-file-alt stat-icon"></i>
                    <div class="stat-number" id="total-applications">0</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle stat-icon"></i>
                    <div class="stat-number" id="approved-applications">0</div>
                    <div class="stat-label">Approved Applications</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-number" id="active-users">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle stat-icon"></i>
                    <div class="stat-number" id="total-complaints">0</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
            </div>
            <div class="service-categories">
                <div class="category-card" data-service="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Apply for various licenses including business, trade, and professional licenses</p>
                </div>
                <div class="category-card" data-service="license-renewal">
                    <i class="fas fa-sync-alt category-icon"></i>
                    <h3>License Renewal</h3>
                    <p>Renew your existing licenses with updated information</p>
                </div>
                <div class="category-card" data-service="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card" data-service="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card" data-service="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Apply for trade licenses for your business</p>
                </div>
                <div class="category-card" data-service="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card" data-service="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Apply for birth certificates</p>
                </div>
                <div class="category-card" data-service="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Apply for death certificates</p>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="section">
            <h2 class="section-title">Municipality Services</h2>
            <div class="service-categories">
                <div class="category-card" data-service="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Apply for various licenses including business, trade, and professional licenses</p>
                </div>
                <div class="category-card" data-service="license-renewal">
                    <i class="fas fa-sync-alt category-icon"></i>
                    <h3>License Renewal</h3>
                    <p>Renew your existing licenses with updated information</p>
                </div>
                <div class="category-card" data-service="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card" data-service="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card" data-service="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Apply for trade licenses for your business</p>
                </div>
                <div class="category-card" data-service="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card" data-service="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Apply for birth certificates</p>
                </div>
                <div class="category-card" data-service="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Apply for death certificates</p>
                </div>
            </div>
        </section>

        <!-- Infrastructure Section -->
        <section id="infrastructure" class="section">
            <h2 class="section-title">Infrastructure Monitoring</h2>
            
            <div class="infrastructure-section">
                <h3>River Water Level Monitoring</h3>
                <p>Track current water levels in Patna's rivers to monitor flood risks.</p>
                
                <div class="map-controls">
                    <button class="btn btn-primary" id="refreshWaterLevel">Refresh Data</button>
                    <select id="riverSelector">
                        <option value="ganga">Ganga River</option>
                        <option value="son">Son River</option>
                        <option value="punpun">Punpun River</option>
                    </select>
                </div>
                
                <div class="map-container">
                    <div class="interactive-map" id="riverMap">
                        <div class="map-background">
                            <!-- Rivers will be dynamically added here -->
                        </div>
                        <div class="map-overlay">
                            <h3>Patna River System</h3>
                            <p>Water Level Monitoring</p>
                        </div>
                    </div>
                </div>
                
                <div class="water-level-info">
                    <h4>Current Water Level: <span id="currentWaterLevel">2.5</span> meters</h4>
                    <div class="water-level-indicator">
                        <div class="water-level-fill" id="waterLevelFill"></div>
                    </div>
                    <div class="water-level-marks">
                        <span>0m</span>
                        <span>2m (Normal)</span>
                        <span>4m (Warning)</span>
                        <span>6m (Danger)</span>
                    </div>
                    <div class="alert-indicator" id="waterAlert">
                        <i class="fas fa-check-circle"></i>
                        <span>Normal Water Level</span>
                    </div>
                </div>
            </div>
            
            <div class="infrastructure-section">
                <h3>Water Pipeline Network</h3>
                <p>View Patna's water pipeline infrastructure and maintenance status.</p>
                
                <div class="map-controls">
                    <button class="btn btn-primary" id="toggleWaterPipelines">Toggle Pipeline View</button>
                    <button class="btn btn-secondary" id="showMaintenance">Show Maintenance Areas</button>
                </div>
                
                <div class="map-container">
                    <div class="interactive-map" id="waterPipelineMap">
                        <div class="map-background">
                            <!-- Water pipelines will be dynamically added here -->
                        </div>
                        <div class="map-overlay">
                            <h3>Patna Water Pipeline Network</h3>
                            <p>Infrastructure Overview</p>
                        </div>
                    </div>
                </div>
                
                <div class="map-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #3498db;"></div>
                        <span>Main Water Lines</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #2980b9;"></div>
                        <span>Secondary Water Lines</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e74c3c;"></div>
                        <span>Maintenance Required</span>
                    </div>
                </div>
            </div>
            
            <div class="infrastructure-section">
                <h3>Gas Pipeline Network</h3>
                <p>View Patna's gas pipeline infrastructure and safety information.</p>
                
                <div class="map-controls">
                    <button class="btn btn-primary" id="toggleGasPipelines">Toggle Pipeline View</button>
                    <button class="btn btn-secondary" id="showSafetyZones">Show Safety Zones</button>
                </div>
                
                <div class="map-container">
                    <div class="interactive-map" id="gasPipelineMap">
                        <div class="map-background">
                            <!-- Gas pipelines will be dynamically added here -->
                        </div>
                        <div class="map-overlay">
                            <h3>Patna Gas Pipeline Network</h3>
                            <p>Safety & Infrastructure</p>
                        </div>
                    </div>
                </div>
                
                <div class="map-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #e67e22;"></div>
                        <span>Main Gas Lines</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #d35400;"></div>
                        <span>Secondary Gas Lines</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #f39c12;"></div>
                        <span>Safety Zones</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- File Complaint Section -->
        <section id="complaints" class="section">
            <h2 class="section-title">File a Complaint</h2>
            <p>Report issues and problems in your area to the municipality</p>
            
            <div class="complaint-categories">
                <div class="complaint-category" data-complaint-type="sanitation">
                    <h3><i class="fas fa-trash"></i> Sanitation Issues</h3>
                    <p>Report garbage collection problems, overflowing bins, or unclean public areas</p>
                </div>
                <div class="complaint-category" data-complaint-type="roads">
                    <h3><i class="fas fa-road"></i> Road & Infrastructure</h3>
                    <p>Report potholes, damaged roads, street light issues, or traffic problems</p>
                </div>
                <div class="complaint-category" data-complaint-type="water">
                    <h3><i class="fas fa-tint"></i> Water Supply</h3>
                    <p>Report water supply issues, leakages, or water quality problems</p>
                </div>
                <div class="complaint-category" data-complaint-type="electricity">
                    <h3><i class="fas fa-bolt"></i> Electricity Issues</h3>
                    <p>Report power outages, electrical hazards, or street light malfunctions</p>
                </div>
            </div>
            
            <div class="complaint-form-container" id="complaintFormContainer" style="display: none;">
                <h3 id="complaintFormTitle">File Complaint</h3>
                <form id="complaintForm" class="application-form">
                    <div class="form-group">
                        <label for="complaintTitle">Complaint Title</label>
                        <input type="text" id="complaintTitle" placeholder="Brief description of the issue" required>
                    </div>
                    <div class="form-group">
                        <label for="complaintDescription">Detailed Description</label>
                        <textarea id="complaintDescription" placeholder="Provide detailed information about the issue, location, and impact" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="complaintLocation">Location</label>
                        <input type="text" id="complaintLocation" placeholder="Exact location or address of the issue" required>
                    </div>
                    <div class="form-group">
                        <label for="complaintPriority">Priority Level</label>
                        <select id="complaintPriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low - Minor inconvenience</option>
                            <option value="medium">Medium - Needs attention</option>
                            <option value="high">High - Urgent attention required</option>
                            <option value="critical">Critical - Safety hazard</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Complaint</button>
                </form>
            </div>
        </section>

        <!-- My Applications Section -->
        <section id="my-applications" class="section">
            <h2 class="section-title">My Applications</h2>
            <div class="application-list" id="applicationList">
                <!-- Application items will be dynamically added here -->
            </div>
        </section>

        <!-- My Complaints Section -->
        <section id="my-complaints" class="section">
            <h2 class="section-title">My Complaints</h2>
            <div class="complaint-list" id="complaintList">
                <!-- Complaint items will be dynamically added here -->
            </div>
        </section>

        <!-- Documentation Section -->
        <section id="documentation" class="section">
            <h2 class="section-title">Documentation Requirements</h2>
            <div class="documentation-info">
                <h3>General Documents Required for All Services</h3>
                <ul>
                    <li>Proof of Identity (Aadhar Card, Passport, Voter ID, etc.)</li>
                    <li>Proof of Address (Aadhar Card, Utility Bill, Rental Agreement, etc.)</li>
                    <li>Passport-sized Photographs</li>
                    <li>Any existing relevant certificates or licenses</li>
                </ul>
            </div>
        </section>

        <!-- Admin Panel Section -->
        <section id="admin" class="section">
            <h2 class="section-title">Admin Panel</h2>
            <div class="admin-panel">
                <div class="admin-sidebar">
                    <ul>
                        <li><a href="#" class="admin-nav active" data-tab="dashboard">Dashboard</a></li>
                        <li><a href="#" class="admin-nav" data-tab="applications-management">Applications Management</a></li>
                        <li><a href="#" class="admin-nav" data-tab="complaints-management">Complaints Management</a></li>
                        <li><a href="#" class="admin-nav" data-tab="infrastructure-management">Infrastructure Management</a></li>
                        <li><a href="#" class="admin-nav" data-tab="settings">Settings</a></li>
                    </ul>
                </div>
                <div class="admin-content">
                    <div id="admin-dashboard" class="admin-tab active">
                        <h3>Admin Dashboard</h3>
                        <div class="stats-cards">
                            <div class="stat-card">
                                <i class="fas fa-file-alt stat-icon"></i>
                                <div class="stat-number" id="admin-total-applications">0</div>
                                <div class="stat-label">Total Applications</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-check-circle stat-icon"></i>
                                <div class="stat-number" id="admin-approved-applications">0</div>
                                <div class="stat-label">Approved Applications</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-exclamation-triangle stat-icon"></i>
                                <div class="stat-number" id="admin-total-complaints">0</div>
                                <div class="stat-label">Total Complaints</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-users stat-icon"></i>
                                <div class="stat-number" id="admin-total-users">0</div>
                                <div class="stat-label">Registered Users</div>
                            </div>
                        </div>
                    </div>
                    <div id="admin-applications-management" class="admin-tab">
                        <h3>Applications Management</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Application ID</th>
                                    <th>User</th>
                                    <th>Service Type</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminApplicationsTable">
                                <!-- Applications will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="admin-complaints-management" class="admin-tab">
                        <h3>Complaints Management</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Complaint ID</th>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Title</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminComplaintsTable">
                                <!-- Complaints will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="admin-infrastructure-management" class="admin-tab">
                        <h3>Infrastructure Management</h3>
                        <div class="infrastructure-management">
                            <div class="infrastructure-form">
                                <h4>Water Level Settings</h4>
                                <div class="form-group">
                                    <label for="waterLevelThreshold">Warning Threshold (meters)</label>
                                    <input type="number" id="waterLevelThreshold" value="4.0" step="0.1" min="0" max="10">
                                </div>
                                <div class="form-group">
                                    <label for="waterLevelDanger">Danger Threshold (meters)</label>
                                    <input type="number" id="waterLevelDanger" value="6.0" step="0.1" min="0" max="10">
                                </div>
                                <button class="btn btn-primary" id="saveWaterSettings">Save Water Settings</button>
                            </div>
                            <div class="infrastructure-form">
                                <h4>Pipeline Settings</h4>
                                <div class="form-group">
                                    <label for="pipelineInspection">Inspection Frequency (days)</label>
                                    <input type="number" id="pipelineInspection" value="90" min="30" max="365">
                                </div>
                                <div class="form-group">
                                    <label for="gasSafetyCheck">Gas Safety Check (days)</label>
                                    <input type="number" id="gasSafetyCheck" value="180" min="60" max="365">
                                </div>
                                <button class="btn btn-primary" id="savePipelineSettings">Save Pipeline Settings</button>
                            </div>
                            <div class="infrastructure-alerts">
                                <h4>Infrastructure Alerts</h4>
                                <div class="application-list">
                                    <div class="application-item">
                                        <div class="application-info">
                                            <h3>Ganga River Water Level Alert</h3>
                                            <p>Water level approaching warning threshold. Current level: 3.8m</p>
                                            <div class="application-meta">
                                                <span><i class="fas fa-clock"></i> 2 hours ago</span>
                                                <span><i class="fas fa-map-marker-alt"></i> Ganga River</span>
                                            </div>
                                        </div>
                                        <div class="application-status">
                                            <span class="status status-pending">Pending Review</span>
                                            <button class="btn btn-primary" style="margin-top: 10px;">Acknowledge</button>
                                        </div>
                                    </div>
                                    <div class="application-item">
                                        <div class="application-info">
                                            <h3>Water Pipeline Maintenance Required</h3>
                                            <p>Pipeline inspection overdue in Kankarbagh area. Last inspection: 95 days ago</p>
                                            <div class="application-meta">
                                                <span><i class="fas fa-clock"></i> 1 day ago</span>
                                                <span><i class="fas fa-map-marker-alt"></i> Kankarbagh</span>
                                            </div>
                                        </div>
                                        <div class="application-status">
                                            <span class="status status-in-progress">Scheduled</span>
                                            <button class="btn btn-primary" style="margin-top: 10px;">View Details</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="admin-settings" class="admin-tab">
                        <h3>Settings</h3>
                        <div class="application-form">
                            <div class="form-group">
                                <label for="systemName">System Name</label>
                                <input type="text" id="systemName" value="Municipality Services Portal">
                            </div>
                            <div class="form-group">
                                <label for="adminEmail">Admin Email</label>
                                <input type="email" id="adminEmail" value="admin@municipality.gov">
                            </div>
                            <button class="btn btn-primary">Save Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chatbot -->
        <div class="chatbot-container">
            <div class="chatbot-toggle" id="chatbotToggle">
                <i class="fas fa-comments"></i>
            </div>
            <div class="chatbot-window" id="chatbotWindow">
                <div class="chatbot-header">
                    <h3>Municipality Assistant</h3>
                    <button id="closeChatbot"><i class="fas fa-times"></i></button>
                </div>
                <div class="chatbot-messages" id="chatbotMessages">
                    <div class="message bot-message">
                        Hello! I'm your municipality assistant. How can I help you today?
                    </div>
                </div>
                <div class="chatbot-input">
                    <input type="text" id="chatbotInput" placeholder="Type your message...">
                    <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="login-modal" id="loginModal">
            <div class="login-form">
                <h2>User Login</h2>
                <form id="userLoginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
                <button class="btn admin-login-btn" id="adminLoginBtn" style="width: 100%; margin-top: 10px;">Admin Login</button>
                <button class="btn btn-secondary" id="closeLoginModal" style="width: 100%; margin-top: 10px;">Cancel</button>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div class="login-modal" id="adminLoginModal">
            <div class="login-form">
                <h2>Admin Login</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminUsername">Username</label>
                        <input type="text" id="adminUsername" placeholder="Enter admin username" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                    </div>
                    <button type="submit" class="btn btn-warning" style="width: 100%;">Login as Admin</button>
                </form>
                <button class="btn btn-secondary" id="closeAdminLoginModal" style="width: 100%; margin-top: 10px;">Cancel</button>
            </div>
        </div>

        <footer>
            <p>&copy; 2023 Municipality Services Portal. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Infrastructure data
        let infrastructureData = JSON.parse(localStorage.getItem('infrastructureData')) || {
            riverWaterLevels: {
                ganga: 2.5,
                son: 1.8,
                punpun: 3.2
            },
            waterPipelines: [
                { id: 1, name: "Main Water Line - West", type: "main", status: "normal", x: 20, y: 50, width: 60, height: 5 },
                { id: 2, name: "Secondary Line - Central", type: "secondary", status: "normal", x: 40, y: 120, width: 40, height: 5 },
                { id: 3, name: "Main Water Line - East", type: "main", status: "maintenance", x: 70, y: 80, width: 50, height: 5 },
                { id: 4, name: "Secondary Line - North", type: "secondary", status: "normal", x: 30, y: 30, width: 30, height: 5 }
            ],
            gasPipelines: [
                { id: 1, name: "Main Gas Line - Central", type: "main", status: "normal", x: 50, y: 60, width: 70, height: 5 },
                { id: 2, name: "Secondary Line - South", type: "secondary", status: "normal", x: 30, y: 100, width: 40, height: 5 },
                { id: 3, name: "Safety Zone - Industrial", type: "safety", status: "normal", x: 70, y: 40, width: 30, height: 30 }
            ],
            settings: {
                waterWarningThreshold: 4.0,
                waterDangerThreshold: 6.0,
                pipelineInspectionFrequency: 90,
                gasSafetyCheckFrequency: 180
            }
        };

        // Sample data for the application
        let applications = JSON.parse(localStorage.getItem('applications')) || [];
        let complaints = JSON.parse(localStorage.getItem('complaints')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, name: "John Doe", email: "john@example.com", phone: "1234567890", address: "123 Main St, City, State 12345", status: "active", applications: 2, complaints: 1, registrationDate: "2023-01-15" }
        ];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let isAdmin = JSON.parse(localStorage.getItem('isAdmin')) || false;
        let applicationIdCounter = parseInt(localStorage.getItem('applicationIdCounter')) || 1001;
        let complaintIdCounter = parseInt(localStorage.getItem('complaintIdCounter')) || 2001;

        // Admin credentials
        const adminCredentials = {
            username: "admin",
            password: "admin123"
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                    
                    // Update infrastructure data when infrastructure section is opened
                    if (sectionId === 'infrastructure') {
                        updateWaterLevelDisplay();
                        renderWaterPipelineMap();
                        renderGasPipelineMap();
                        renderRiverMap();
                    }
                    
                    // Update admin panel data when admin section is opened
                    if (sectionId === 'admin') {
                        updateAdminApplicationsTable();
                        updateAdminComplaintsTable();
                        updateAdminStats();
                    }
                });
            });

            // Admin navigation
            document.querySelectorAll('.admin-nav').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.admin-nav').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.admin-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`admin-${tabId}`).classList.add('active');
                });
            });

            // Infrastructure controls
            document.getElementById('refreshWaterLevel').addEventListener('click', function() {
                // Simulate fetching new water level data
                const river = document.getElementById('riverSelector').value;
                const newLevel = infrastructureData.riverWaterLevels[river] + (Math.random() * 0.5 - 0.25); // Small random change
                infrastructureData.riverWaterLevels[river] = Math.max(0, Math.min(8, newLevel)); // Keep between 0 and 8 meters
                saveInfrastructureData();
                updateWaterLevelDisplay();
            });

            document.getElementById('riverSelector').addEventListener('change', function() {
                updateWaterLevelDisplay();
            });

            document.getElementById('toggleWaterPipelines').addEventListener('click', function() {
                // Toggle pipeline visibility (in a real app, this would show/hide different layers)
                alert('Toggling water pipeline view. In a real application, this would show/hide different pipeline layers.');
            });

            document.getElementById('showMaintenance').addEventListener('click', function() {
                // Highlight maintenance areas
                const maintenancePipelines = infrastructureData.waterPipelines.filter(p => p.status === 'maintenance');
                if (maintenancePipelines.length > 0) {
                    alert(`There are ${maintenancePipelines.length} water pipelines requiring maintenance.`);
                } else {
                    alert('No water pipelines currently require maintenance.');
                }
            });

            document.getElementById('toggleGasPipelines').addEventListener('click', function() {
                // Toggle pipeline visibility
                alert('Toggling gas pipeline view. In a real application, this would show/hide different pipeline layers.');
            });

            document.getElementById('showSafetyZones').addEventListener('click', function() {
                // Highlight safety zones
                const safetyZones = infrastructureData.gasPipelines.filter(p => p.type === 'safety');
                if (safetyZones.length > 0) {
                    alert(`There are ${safetyZones.length} safety zones in the gas pipeline network.`);
                } else {
                    alert('No safety zones defined in the gas pipeline network.');
                }
            });

            // Infrastructure management
            document.getElementById('saveWaterSettings').addEventListener('click', function() {
                infrastructureData.settings.waterWarningThreshold = parseFloat(document.getElementById('waterLevelThreshold').value);
                infrastructureData.settings.waterDangerThreshold = parseFloat(document.getElementById('waterLevelDanger').value);
                saveInfrastructureData();
                alert('Water level settings saved successfully!');
            });

            document.getElementById('savePipelineSettings').addEventListener('click', function() {
                infrastructureData.settings.pipelineInspectionFrequency = parseInt(document.getElementById('pipelineInspection').value);
                infrastructureData.settings.gasSafetyCheckFrequency = parseInt(document.getElementById('gasSafetyCheck').value);
                saveInfrastructureData();
                alert('Pipeline settings saved successfully!');
            });

            // Load infrastructure settings
            document.getElementById('waterLevelThreshold').value = infrastructureData.settings.waterWarningThreshold;
            document.getElementById('waterLevelDanger').value = infrastructureData.settings.waterDangerThreshold;
            document.getElementById('pipelineInspection').value = infrastructureData.settings.pipelineInspectionFrequency;
            document.getElementById('gasSafetyCheck').value = infrastructureData.settings.gasSafetyCheckFrequency;

            // Initialize infrastructure maps
            updateWaterLevelDisplay();
            renderWaterPipelineMap();
            renderGasPipelineMap();
            renderRiverMap();

            // Initialize UI
            updateApplicationList();
            updateComplaintList();
            updateAdminApplicationsTable();
            updateAdminComplaintsTable();
            updateStats();
            updateAdminStats();
            init3DAnimation();
            updateUIForUser();

            // Set up periodic updates for demo purposes
            setInterval(updateStats, 5000);
        });

        // Update water level display
        function updateWaterLevelDisplay() {
            const river = document.getElementById('riverSelector').value;
            const waterLevel = infrastructureData.riverWaterLevels[river];
            
            document.getElementById('currentWaterLevel').textContent = waterLevel.toFixed(1);
            
            // Update water level indicator
            const waterLevelFill = document.getElementById('waterLevelFill');
            const percentage = Math.min(100, (waterLevel / 8) * 100);
            waterLevelFill.style.width = `${percentage}%`;
            
            // Update alert indicator
            const waterAlert = document.getElementById('waterAlert');
            if (waterLevel < infrastructureData.settings.waterWarningThreshold) {
                waterAlert.className = 'alert-indicator alert-low';
                waterAlert.innerHTML = '<i class="fas fa-check-circle"></i><span>Normal Water Level</span>';
            } else if (waterLevel < infrastructureData.settings.waterDangerThreshold) {
                waterAlert.className = 'alert-indicator alert-medium';
                waterAlert.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Warning: High Water Level</span>';
            } else {
                waterAlert.className = 'alert-indicator alert-high';
                waterAlert.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>Danger: Flood Risk</span>';
            }
        }

        // Render water pipeline map
        function renderWaterPipelineMap() {
            const mapContainer = document.getElementById('waterPipelineMap');
            const background = mapContainer.querySelector('.map-background');
            
            // Clear existing pipelines
            const existingPipelines = background.querySelectorAll('.pipeline');
            existingPipelines.forEach(p => p.remove());
            
            // Add pipelines
            infrastructureData.waterPipelines.forEach(pipeline => {
                const pipelineElement = document.createElement('div');
                pipelineElement.className = `pipeline water-pipeline ${pipeline.status === 'maintenance' ? 'pipeline-maintenance' : ''}`;
                pipelineElement.style.left = `${pipeline.x}%`;
                pipelineElement.style.top = `${pipeline.y}%`;
                pipelineElement.style.width = `${pipeline.width}%`;
                pipelineElement.style.height = `${pipeline.height}px`;
                pipelineElement.setAttribute('data-id', pipeline.id);
                
                // Add hover info
                pipelineElement.addEventListener('mouseenter', function(e) {
                    showPipelineInfo(e, pipeline);
                });
                
                pipelineElement.addEventListener('mouseleave', function() {
                    hidePipelineInfo();
                });
                
                background.appendChild(pipelineElement);
            });
        }

        // Render gas pipeline map
        function renderGasPipelineMap() {
            const mapContainer = document.getElementById('gasPipelineMap');
            const background = mapContainer.querySelector('.map-background');
            
            // Clear existing pipelines
            const existingPipelines = background.querySelectorAll('.pipeline');
            existingPipelines.forEach(p => p.remove());
            
            // Add pipelines
            infrastructureData.gasPipelines.forEach(pipeline => {
                const pipelineElement = document.createElement('div');
                let pipelineClass = 'pipeline ';
                
                if (pipeline.type === 'safety') {
                    pipelineClass += 'pipeline-safety-zone';
                } else {
                    pipelineClass += 'gas-pipeline';
                }
                
                pipelineElement.className = pipelineClass;
                pipelineElement.style.left = `${pipeline.x}%`;
                pipelineElement.style.top = `${pipeline.y}%`;
                
                if (pipeline.type === 'safety') {
                    pipelineElement.style.width = `${pipeline.width}%`;
                    pipelineElement.style.height = `${pipeline.height}%`;
                    pipelineElement.style.borderRadius = '10px';
                    pipelineElement.style.opacity = '0.3';
                } else {
                    pipelineElement.style.width = `${pipeline.width}%`;
                    pipelineElement.style.height = `${pipeline.height}px`;
                }
                
                pipelineElement.setAttribute('data-id', pipeline.id);
                
                // Add hover info
                pipelineElement.addEventListener('mouseenter', function(e) {
                    showPipelineInfo(e, pipeline);
                });
                
                pipelineElement.addEventListener('mouseleave', function() {
                    hidePipelineInfo();
                });
                
                background.appendChild(pipelineElement);
            });
        }

        // Render river map
        function renderRiverMap() {
            const mapContainer = document.getElementById('riverMap');
            const background = mapContainer.querySelector('.map-background');
            
            // Clear existing rivers
            const existingRivers = background.querySelectorAll('.river');
            existingRivers.forEach(r => r.remove());
            
            // Add Ganga River
            const gangaRiver = document.createElement('div');
            gangaRiver.className = 'river';
            gangaRiver.style.left = '10%';
            gangaRiver.style.top = '40%';
            gangaRiver.style.width = '80%';
            gangaRiver.style.height = '30px';
            background.appendChild(gangaRiver);
            
            // Add Son River
            const sonRiver = document.createElement('div');
            sonRiver.className = 'river';
            sonRiver.style.left = '60%';
            sonRiver.style.top = '70%';
            sonRiver.style.width = '30%';
            sonRiver.style.height = '20px';
            background.appendChild(sonRiver);
            
            // Add Punpun River
            const punpunRiver = document.createElement('div');
            punpunRiver.className = 'river';
            punpunRiver.style.left = '20%';
            punpunRiver.style.top = '20%';
            punpunRiver.style.width = '20%';
            punpunRiver.style.height = '15px';
            background.appendChild(punpunRiver);
        }

        // Show pipeline info on hover
        function showPipelineInfo(event, pipeline) {
            // Remove existing info
            hidePipelineInfo();
            
            const infoElement = document.createElement('div');
            infoElement.className = 'pipeline-info';
            infoElement.innerHTML = `
                <h4>${pipeline.name}</h4>
                <p>Type: ${pipeline.type === 'main' ? 'Main Line' : pipeline.type === 'secondary' ? 'Secondary Line' : 'Safety Zone'}</p>
                <p>Status: ${pipeline.status === 'normal' ? 'Normal' : 'Maintenance Required'}</p>
            `;
            
            // Position near the cursor
            infoElement.style.left = `${event.pageX + 10}px`;
            infoElement.style.top = `${event.pageY + 10}px`;
            infoElement.style.display = 'block';
            
            document.body.appendChild(infoElement);
        }

        // Hide pipeline info
        function hidePipelineInfo() {
            const existingInfo = document.querySelector('.pipeline-info');
            if (existingInfo) {
                existingInfo.remove();
            }
        }

        // Data management functions
        function saveInfrastructureData() {
            localStorage.setItem('infrastructureData', JSON.stringify(infrastructureData));
        }

        function saveData() {
            localStorage.setItem('applications', JSON.stringify(applications));
            localStorage.setItem('complaints', JSON.stringify(complaints));
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('applicationIdCounter', applicationIdCounter.toString());
            localStorage.setItem('complaintIdCounter', complaintIdCounter.toString());
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
        }

        function updateApplicationList() {
            const applicationList = document.getElementById('applicationList');
            applicationList.innerHTML = '';
            
            let userApplications = applications;
            if (currentUser) {
                userApplications = applications.filter(a => a.userId === currentUser.id);
            }
            
            if (userApplications.length === 0) {
                applicationList.innerHTML = '<p>No applications found.</p>';
                return;
            }
            
            userApplications.forEach(application => {
                const applicationItem = document.createElement('div');
                applicationItem.className = 'application-item';
                
                const statusClass = `status-${application.status.replace(' ', '-')}`;
                
                applicationItem.innerHTML = `
                    <div class="application-info">
                        <h3>${application.serviceType} (ID: ${application.id})</h3>
                        <p>Submitted on: ${application.date}</p>
                        <div class="application-meta">
                            <span><i class="fas fa-calendar"></i> ${application.date}</span>
                            <span><i class="fas fa-user"></i> ${application.userName}</span>
                        </div>
                    </div>
                    <div class="application-status">
                        <span class="status ${statusClass}">${application.status}</span>
                    </div>
                `;
                
                applicationList.appendChild(applicationItem);
            });
        }

        function updateComplaintList() {
            const complaintList = document.getElementById('complaintList');
            complaintList.innerHTML = '';
            
            let userComplaints = complaints;
            if (currentUser) {
                userComplaints = complaints.filter(c => c.userId === currentUser.id);
            }
            
            if (userComplaints.length === 0) {
                complaintList.innerHTML = '<p>No complaints found.</p>';
                return;
            }
            
            userComplaints.forEach(complaint => {
                const complaintItem = document.createElement('div');
                complaintItem.className = 'complaint-item';
                
                const statusClass = `status-${complaint.status}`;
                
                complaintItem.innerHTML = `
                    <div class="complaint-info">
                        <h3>${complaint.title} (ID: ${complaint.id})</h3>
                        <p>Type: ${complaint.type}</p>
                        <div class="complaint-meta">
                            <span><i class="fas fa-calendar"></i> ${complaint.date}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${complaint.location}</span>
                            <span><i class="fas fa-exclamation-circle"></i> ${complaint.priority}</span>
                        </div>
                    </div>
                    <div class="complaint-status">
                        <span class="status ${statusClass}">${complaint.status}</span>
                    </div>
                `;
                
                complaintList.appendChild(complaintItem);
            });
        }

        function updateAdminApplicationsTable() {
            const tableBody = document.getElementById('adminApplicationsTable');
            tableBody.innerHTML = '';
            
            if (applications.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No applications found.</td></tr>';
                return;
            }
            
            applications.forEach(application => {
                const row = document.createElement('tr');
                
                const statusClass = `status-${application.status.replace(' ', '-')}`;
                
                row.innerHTML = `
                    <td>${application.id}</td>
                    <td>${application.userName}</td>
                    <td>${application.serviceType}</td>
                    <td>${application.date}</td>
                    <td><span class="status ${statusClass}">${application.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn">View</button>
                        <button class="action-btn edit-btn">Edit</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function updateAdminComplaintsTable() {
            const tableBody = document.getElementById('adminComplaintsTable');
            tableBody.innerHTML = '';
            
            if (complaints.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No complaints found.</td></tr>';
                return;
            }
            
            complaints.forEach(complaint => {
                const row = document.createElement('tr');
                
                const statusClass = `status-${complaint.status}`;
                
                row.innerHTML = `
                    <td>${complaint.id}</td>
                    <td>${complaint.userName}</td>
                    <td>${complaint.type}</td>
                    <td>${complaint.title}</td>
                    <td>${complaint.date}</td>
                    <td><span class="status ${statusClass}">${complaint.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn">View</button>
                        <button class="action-btn edit-btn">Edit</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        function updateStats() {
            // Update home stats
            document.getElementById('total-applications').textContent = applications.length;
            document.getElementById('approved-applications').textContent = applications.filter(a => a.status === 'approved').length;
            document.getElementById('active-users').textContent = users.filter(u => u.status === 'active').length;
            document.getElementById('total-complaints').textContent = complaints.length;
        }

        function updateAdminStats() {
            // Update admin stats
            document.getElementById('admin-total-applications').textContent = applications.length;
            document.getElementById('admin-approved-applications').textContent = applications.filter(a => a.status === 'approved').length;
            document.getElementById('admin-total-complaints').textContent = complaints.length;
            document.getElementById('admin-total-users').textContent = users.length;
        }

        // 3D Animation using Three.js
        function init3DAnimation() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // Create scene
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // Create city buildings
            const buildings = [];
            const buildingColors = [0x3498db, 0x2ecc71, 0xe74c3c, 0xf39c12, 0x9b59b6];
            
            for (let i = 0; i < 15; i++) {
                const width = Math.random() * 2 + 1;
                const height = Math.random() * 3 + 2;
                const depth = Math.random() * 2 + 1;
                
                const geometry = new THREE.BoxGeometry(width, height, depth);
                const color = buildingColors[Math.floor(Math.random() * buildingColors.length)];
                const material = new THREE.MeshPhongMaterial({ color: color });
                const building = new THREE.Mesh(geometry, material);
                
                building.position.x = (Math.random() - 0.5) * 20;
                building.position.z = (Math.random() - 0.5) * 20;
                building.position.y = height / 2;
                
                scene.add(building);
                buildings.push(building);
            }
            
            // Add ground
            const groundGeometry = new THREE.PlaneGeometry(30, 30);
            const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x95a5a6, side: THREE.DoubleSide });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = Math.PI / 2;
            ground.position.y = -1;
            scene.add(ground);
            
            // Position camera
            camera.position.z = 15;
            camera.position.y = 5;
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                // Rotate buildings slightly
                buildings.forEach(building => {
                    building.rotation.y += 0.005;
                });
                
                // Rotate camera around the scene
                const time = Date.now() * 0.0005;
                camera.position.x = Math.sin(time) * 15;
                camera.position.z = Math.cos(time) * 15;
                camera.lookAt(0, 0, 0);
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', function() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }

        // Login/Register functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            document.getElementById('loginModal').style.display = 'flex';
        });

        document.getElementById('closeLoginModal').addEventListener('click', function() {
            document.getElementById('loginModal').style.display = 'none';
        });

        document.getElementById('adminLoginBtn').addEventListener('click', function() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('adminLoginModal').style.display = 'flex';
        });

        document.getElementById('closeAdminLoginModal').addEventListener('click', function() {
            document.getElementById('adminLoginModal').style.display = 'none';
        });

        document.getElementById('userLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple authentication - in a real app, this would be more secure
            let user = users.find(u => u.email === email);
            if (user) {
                currentUser = user;
                isAdmin = false;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
                document.getElementById('loginModal').style.display = 'none';
                alert(`Welcome back, ${user.name}!`);
                updateUIForUser();
            } else {
                alert('User not found. Please register.');
            }
        });

        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            if (username === adminCredentials.username && password === adminCredentials.password) {
                isAdmin = true;
                localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
                document.getElementById('adminLoginModal').style.display = 'none';
                alert('Welcome, Admin!');
                updateUIForUser();
            } else {
                alert('Invalid admin credentials. Please try again.');
            }
        });

        function updateUIForUser() {
            if (currentUser || isAdmin) {
                document.getElementById('loginBtn').textContent = 'Logout';
                document.getElementById('registerBtn').style.display = 'none';
                
                document.getElementById('loginBtn').onclick = function() {
                    currentUser = null;
                    isAdmin = false;
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('isAdmin');
                    alert('You have been logged out.');
                    location.reload();
                };
            }
        }

        // Chatbot functionality
        document.getElementById('chatbotToggle').addEventListener('click', function() {
            document.getElementById('chatbotWindow').style.display = 'flex';
        });

        document.getElementById('closeChatbot').addEventListener('click', function() {
            document.getElementById('chatbotWindow').style.display = 'none';
        });

        document.getElementById('sendMessage').addEventListener('click', sendMessage);
        document.getElementById('chatbotInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (message) {
                // Add user message
                addMessage(message, 'user');
                input.value = '';
                
                // Generate bot response
                setTimeout(() => {
                    const response = generateBotResponse(message);
                    addMessage(response, 'bot');
                }, 500);
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);
            messageElement.textContent = text;
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function generateBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('water') || lowerMessage.includes('pipeline')) {
                return "I can help you with water pipeline information. You can view the water pipeline network in the Infrastructure section.";
            } else if (lowerMessage.includes('gas') || lowerMessage.includes('pipeline')) {
                return "I can help you with gas pipeline information. You can view the gas pipeline network in the Infrastructure section.";
            } else if (lowerMessage.includes('river') || lowerMessage.includes('water level')) {
                return "I can help you with river water level monitoring. You can check current water levels in the Infrastructure section.";
            } else if (lowerMessage.includes('complaint')) {
                return "I can help you file a complaint. Please visit the 'File Complaint' section to report any issues.";
            } else if (lowerMessage.includes('application') || lowerMessage.includes('apply')) {
                return "I can help you with municipality services applications. Please visit the 'Services' section to apply for various services.";
            } else {
                return "I'm here to help with municipality services. You can ask me about water pipelines, gas pipelines, river monitoring, filing complaints, or applying for services.";
            }
        }

        // Complaint functionality
        document.querySelectorAll('.complaint-category').forEach(card => {
            card.addEventListener('click', function() {
                const complaintType = this.getAttribute('data-complaint-type');
                loadComplaintForm(complaintType);
            });
        });

        function loadComplaintForm(complaintType) {
            const complaintFormContainer = document.getElementById('complaintFormContainer');
            const complaintFormTitle = document.getElementById('complaintFormTitle');
            
            complaintFormTitle.textContent = `File ${complaintType} Complaint`;
            complaintFormContainer.style.display = 'block';
            
            // Set up form submission
            const complaintForm = document.getElementById('complaintForm');
            complaintForm.onsubmit = function(e) {
                e.preventDefault();
                submitComplaint(complaintType, this);
            };
            
            // Scroll to form
            complaintFormContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function submitComplaint(complaintType, form) {
            if (!currentUser) {
                alert('Please login to submit a complaint.');
                return;
            }
            
            const formData = new FormData(form);
            const complaintData = {};
            
            for (let [key, value] of formData.entries()) {
                complaintData[key] = value;
            }
            
            const complaint = {
                id: complaintIdCounter++,
                userId: currentUser.id,
                type: complaintType,
                title: complaintData.complaintTitle,
                description: complaintData.complaintDescription,
                location: complaintData.complaintLocation,
                priority: complaintData.complaintPriority,
                status: 'open',
                date: new Date().toISOString().split('T')[0],
                userName: currentUser.name,
                userEmail: currentUser.email,
                userPhone: currentUser.phone,
                adminNotes: '',
                resolutionDate: null
            };
            
            complaints.push(complaint);
            saveData();
            
            alert(`Complaint submitted successfully! Your complaint ID is: ${complaint.id}`);
            form.reset();
            
            // Update complaint lists
            updateComplaintList();
            updateAdminComplaintsTable();
            updateStats();
            updateAdminStats();
        }
    </script>
</body>
</html>
