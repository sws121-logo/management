<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Municipality Services Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: var(--primary);
            color: white;
            width: 100%;
            padding: 15px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            flex-wrap: wrap;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--secondary);
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        nav {
            width: 100%;
            order: 3;
            margin-top: 15px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 5px;
            transition: background 0.3s;
            font-size: 0.9rem;
        }
        
        nav a:hover, nav a.active {
            background: var(--secondary);
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--accent);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            color: var(--primary);
        }
        
        .service-categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border-left: 4px solid var(--secondary);
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .category-icon {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        .application-form {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .file-upload-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-container:hover {
            border-color: var(--secondary);
            background-color: #f8f9fa;
        }
        
        .file-upload-container i {
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .file-preview-item .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .application-list, .complaint-list {
            display: grid;
            gap: 15px;
        }
        
        .application-item, .complaint-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--secondary);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .application-info h3, .complaint-info h3 {
            margin-bottom: 5px;
        }
        
        .application-meta, .complaint-meta {
            display: flex;
            gap: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
            flex-wrap: wrap;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-in-progress {
            background: #cce7ff;
            color: #004085;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-resolved {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-open {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-investigation {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-closed {
            background: #d4edda;
            color: #155724;
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--secondary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
        }
        
        .chatbot-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            max-width: 90vw;
            height: 450px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chatbot-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
        }
        
        .bot-message {
            background: #f1f1f1;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .chatbot-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
        }
        
        .chatbot-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
        }
        
        .chatbot-input button {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }
        
        /* FIXED ADMIN PANEL STYLES */
        .admin-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            overflow: hidden;
        }
        
        .admin-sidebar {
            background: var(--primary);
            color: white;
            border-radius: 10px;
            padding: 20px;
            width: 100%;
        }
        
        .admin-sidebar ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .admin-sidebar li {
            flex: 1;
            min-width: 150px;
        }
        
        .admin-sidebar a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 5px;
            transition: background 0.3s;
            text-align: center;
        }
        
        .admin-sidebar a:hover, .admin-sidebar a.active {
            background: var(--secondary);
        }
        
        .admin-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            overflow-x: auto;
        }
        
        .admin-tab {
            display: none;
            width: 100%;
        }
        
        .admin-tab.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .edit-btn {
            background: var(--warning);
            color: white;
        }
        
        .delete-btn {
            background: var(--accent);
            color: white;
        }
        
        .view-btn {
            background: var(--secondary);
            color: white;
        }
        
        .canvas-container {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-top: 4px solid var(--secondary);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .documentation-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .documentation-info h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .documentation-info ul {
            padding-left: 20px;
        }
        
        .documentation-info li {
            margin-bottom: 8px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            width: 100%;
            margin-top: 40px;
            color: #7f8c8d;
            border-top: 1px solid #eee;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1002;
            align-items: center;
            justify-content: center;
        }
        
        .login-form {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .login-form h2 {
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary);
        }
        
        .login-form .form-group {
            margin-bottom: 15px;
        }
        
        .admin-login-btn {
            background: var(--warning);
            color: white;
            margin-top: 10px;
        }
        
        .chatbot-quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .quick-action-btn {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .quick-action-btn:hover {
            background: #2980b9;
        }
        
        .service-steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .service-steps h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .service-steps ol {
            padding-left: 20px;
        }
        
        .service-steps li {
            margin-bottom: 5px;
        }
        
        .document-list {
            background: #fff3cd;
            border-radius: 5px;
            padding: 8px;
            margin: 5px 0;
        }
        
        .document-list ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .apply-now-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .chart-title {
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        .admin-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .back-button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .complaint-categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .complaint-category {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--accent);
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .complaint-category:hover {
            transform: translateY(-5px);
        }
        
        .complaint-category h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .complaint-category p {
            color: #7f8c8d;
            margin-bottom: 15px;
        }
        
        .complaint-form-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .complaint-details {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--warning);
        }
        
        .complaint-details h4 {
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .complaint-details p {
            margin-bottom: 8px;
        }
        
        .complaint-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .logo {
                justify-content: center;
                text-align: center;
            }
            
            .logo h1 {
                font-size: 1.5rem;
            }
            
            nav ul {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            nav a {
                padding: 10px 15px;
                width: 100%;
                text-align: center;
            }
            
            .user-actions {
                width: 100%;
                justify-content: center;
            }
            
            .service-categories {
                grid-template-columns: 1fr;
            }
            
            .stats-cards {
                grid-template-columns: 1fr 1fr;
            }
            
            .admin-sidebar ul {
                flex-direction: column;
            }
            
            .admin-sidebar li {
                min-width: 100%;
            }
            
            .chart-row {
                grid-template-columns: 1fr;
            }
            
            .complaint-categories {
                grid-template-columns: 1fr;
            }
            
            .chatbot-window {
                width: 95vw;
                right: -10px;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .complaint-actions {
                flex-direction: column;
            }
            
            .application-item, .complaint-item {
                flex-direction: column;
            }
            
            .application-status, .complaint-status {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
            }
        }
        
        @media (min-width: 769px) {
            .header-content {
                flex-wrap: nowrap;
            }
            
            nav {
                width: auto;
                order: 2;
                margin-top: 0;
            }
            
            .user-actions {
                order: 3;
            }
            
            .admin-panel {
                flex-direction: row;
            }
            
            .admin-sidebar {
                width: 250px;
            }
            
            .admin-sidebar ul {
                flex-direction: column;
            }
            
            .admin-sidebar li {
                min-width: 100%;
            }
            
            .service-categories {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (min-width: 1025px) {
            .service-categories {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-city"></i>
                    <h1>Municipality Services Portal</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-section="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-section="services">Services</a></li>
                        <li><a href="#" class="nav-link" data-section="complaints">File Complaint</a></li>
                        <li><a href="#" class="nav-link" data-section="my-applications">My Applications</a></li>
                        <li><a href="#" class="nav-link" data-section="my-complaints">My Complaints</a></li>
                        <li><a href="#" class="nav-link" data-section="documentation">Documentation</a></li>
                        <li><a href="#" class="nav-link" data-section="admin">Admin Panel</a></li>
                    </ul>
                </nav>
                <div class="user-actions">
                    <button class="btn btn-primary" id="loginBtn">Login</button>
                    <button class="btn btn-secondary" id="registerBtn">Register</button>
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="home" class="section active">
            <h2 class="section-title">Welcome to Municipality Services Portal</h2>
            <div class="canvas-container" id="animation-container"></div>
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-file-alt stat-icon"></i>
                    <div class="stat-number" id="total-applications">0</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle stat-icon"></i>
                    <div class="stat-number" id="approved-applications">0</div>
                    <div class="stat-label">Approved Applications</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-number" id="active-users">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle stat-icon"></i>
                    <div class="stat-number" id="total-complaints">0</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
            </div>
            <div class="service-categories">
                <div class="category-card" data-service="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Apply for various licenses including business, trade, and professional licenses</p>
                </div>
                <div class="category-card" data-service="license-renewal">
                    <i class="fas fa-sync-alt category-icon"></i>
                    <h3>License Renewal</h3>
                    <p>Renew your existing licenses with updated information</p>
                </div>
                <div class="category-card" data-service="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card" data-service="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card" data-service="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Apply for trade licenses for your business</p>
                </div>
                <div class="category-card" data-service="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card" data-service="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Apply for birth certificates</p>
                </div>
                <div class="category-card" data-service="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Apply for death certificates</p>
                </div>
                <!-- NEW SERVICES -->
                <div class="category-card" data-service="marriage-certificate">
                    <i class="fas fa-ring category-icon"></i>
                    <h3>Marriage Certificate</h3>
                    <p>Apply for marriage registration and certificate</p>
                </div>
                <div class="category-card" data-service="water-connection">
                    <i class="fas fa-tint category-icon"></i>
                    <h3>Water Connection</h3>
                    <p>Apply for new water connection or transfer</p>
                </div>
                <div class="category-card" data-service="electricity-connection">
                    <i class="fas fa-bolt category-icon"></i>
                    <h3>Electricity Connection</h3>
                    <p>Apply for new electricity connection</p>
                </div>
                <div class="category-card" data-service="grievance-redressal">
                    <i class="fas fa-gavel category-icon"></i>
                    <h3>Grievance Redressal</h3>
                    <p>File grievances and seek resolution</p>
                </div>
                <div class="category-card" data-service="encumbrance-certificate">
                    <i class="fas fa-file-contract category-icon"></i>
                    <h3>Encumbrance Certificate</h3>
                    <p>Apply for property encumbrance certificate</p>
                </div>
                <div class="category-card" data-service="pension-scheme">
                    <i class="fas fa-hand-holding-usd category-icon"></i>
                    <h3>Pension Scheme</h3>
                    <p>Apply for senior citizen pension schemes</p>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="section">
            <h2 class="section-title">Municipality Services</h2>
            <div class="service-categories">
                <div class="category-card" data-service="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Apply for various licenses including business, trade, and professional licenses</p>
                </div>
                <div class="category-card" data-service="license-renewal">
                    <i class="fas fa-sync-alt category-icon"></i>
                    <h3>License Renewal</h3>
                    <p>Renew your existing licenses with updated information</p>
                </div>
                <div class="category-card" data-service="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card" data-service="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card" data-service="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Apply for trade licenses for your business</p>
                </div>
                <div class="category-card" data-service="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card" data-service="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Apply for birth certificates</p>
                </div>
                <div class="category-card" data-service="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Apply for death certificates</p>
                </div>
                <!-- NEW SERVICES -->
                <div class="category-card" data-service="marriage-certificate">
                    <i class="fas fa-ring category-icon"></i>
                    <h3>Marriage Certificate</h3>
                    <p>Apply for marriage registration and certificate</p>
                </div>
                <div class="category-card" data-service="water-connection">
                    <i class="fas fa-tint category-icon"></i>
                    <h3>Water Connection</h3>
                    <p>Apply for new water connection or transfer</p>
                </div>
                <div class="category-card" data-service="electricity-connection">
                    <i class="fas fa-bolt category-icon"></i>
                    <h3>Electricity Connection</h3>
                    <p>Apply for new electricity connection</p>
                </div>
                <div class="category-card" data-service="grievance-redressal">
                    <i class="fas fa-gavel category-icon"></i>
                    <h3>Grievance Redressal</h3>
                    <p>File grievances and seek resolution</p>
                </div>
                <div class="category-card" data-service="encumbrance-certificate">
                    <i class="fas fa-file-contract category-icon"></i>
                    <h3>Encumbrance Certificate</h3>
                    <p>Apply for property encumbrance certificate</p>
                </div>
                <div class="category-card" data-service="pension-scheme">
                    <i class="fas fa-hand-holding-usd category-icon"></i>
                    <h3>Pension Scheme</h3>
                    <p>Apply for senior citizen pension schemes</p>
                </div>
            </div>
        </section>

        <!-- Service Application Forms -->
        <section id="service-forms" class="section">
            <!-- Forms will be dynamically loaded here based on service selection -->
        </section>

        <!-- Chatbot -->
        <div class="chatbot-container">
            <div class="chatbot-toggle" id="chatbotToggle">
                <i class="fas fa-comments"></i>
            </div>
            <div class="chatbot-window" id="chatbotWindow">
                <div class="chatbot-header">
                    <h3>Municipality Assistant</h3>
                    <button id="closeChatbot"><i class="fas fa-times"></i></button>
                </div>
                <div class="chatbot-messages" id="chatbotMessages">
                    <div class="message bot-message">
                        Hello! I'm your municipality assistant. How can I help you today?
                    </div>
                </div>
                <div class="chatbot-input">
                    <input type="text" id="chatbotInput" placeholder="Type your message...">
                    <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2023 Municipality Services Portal. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Sample data for the application
        let applications = JSON.parse(localStorage.getItem('applications')) || [];
        let complaints = JSON.parse(localStorage.getItem('complaints')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, name: "John Doe", email: "john@example.com", phone: "1234567890", status: "active", applications: 2, complaints: 1, registrationDate: "2023-01-15" },
            { id: 2, name: "Jane Smith", email: "jane@example.com", phone: "0987654321", status: "active", applications: 1, complaints: 0, registrationDate: "2023-02-20" },
            { id: 3, name: "Robert Johnson", email: "robert@example.com", phone: "1122334455", status: "active", applications: 3, complaints: 2, registrationDate: "2023-03-10" },
            { id: 4, name: "Emily Davis", email: "emily@example.com", phone: "5566778899", status: "inactive", applications: 0, complaints: 1, registrationDate: "2023-04-05" }
        ];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let isAdmin = JSON.parse(localStorage.getItem('isAdmin')) || false;
        let applicationIdCounter = parseInt(localStorage.getItem('applicationIdCounter')) || 1001;
        let complaintIdCounter = parseInt(localStorage.getItem('complaintIdCounter')) || 2001;
        let userIdCounter = parseInt(localStorage.getItem('userIdCounter')) || 5;

        // Admin credentials
        const adminCredentials = {
            username: "admin",
            password: "admin123"
        };

        // Service-specific forms - ADDED NEW FORMS
        const serviceForms = {
            license: `
                <h2 class="section-title">License Application</h2>
                <form id="licenseForm" class="application-form">
                    <div class="form-group">
                        <label for="licenseType">License Type</label>
                        <select id="licenseType" required>
                            <option value="">Select License Type</option>
                            <option value="business">Business License</option>
                            <option value="professional">Professional License</option>
                            <option value="trade">Trade License</option>
                            <option value="vehicle">Vehicle License</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea id="address" placeholder="Enter your complete address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email address" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="aadharFrontUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Aadhar Card (Front)</p>
                            <input type="file" id="aadharFront" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="aadharBackUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Aadhar Card (Back)</p>
                            <input type="file" id="aadharBack" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="photoUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Passport Photo</p>
                            <input type="file" id="photo" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            // ADDED NEW SERVICE FORMS
            "marriage-certificate": `
                <h2 class="section-title">Marriage Certificate Application</h2>
                <form id="marriageCertificateForm" class="application-form">
                    <div class="form-group">
                        <label for="husbandName">Husband's Full Name</label>
                        <input type="text" id="husbandName" placeholder="Enter husband's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="wifeName">Wife's Full Name</label>
                        <input type="text" id="wifeName" placeholder="Enter wife's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="marriageDate">Marriage Date</label>
                        <input type="date" id="marriageDate" required>
                    </div>
                    <div class="form-group">
                        <label for="marriagePlace">Place of Marriage</label>
                        <input type="text" id="marriagePlace" placeholder="Enter place of marriage" required>
                    </div>
                    <div class="form-group">
                        <label for="witness1">Witness 1 Name</label>
                        <input type="text" id="witness1" placeholder="Enter witness name" required>
                    </div>
                    <div class="form-group">
                        <label for="witness2">Witness 2 Name</label>
                        <input type="text" id="witness2" placeholder="Enter witness name" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="marriageProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Marriage Proof</p>
                            <input type="file" id="marriageProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="husbandIdUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Husband's ID Proof</p>
                            <input type="file" id="husbandId" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="wifeIdUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Wife's ID Proof</p>
                            <input type="file" id="wifeId" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            "water-connection": `
                <h2 class="section-title">Water Connection Application</h2>
                <form id="waterConnectionForm" class="application-form">
                    <div class="form-group">
                        <label for="connectionType">Connection Type</label>
                        <select id="connectionType" required>
                            <option value="">Select Connection Type</option>
                            <option value="domestic">Domestic</option>
                            <option value="commercial">Commercial</option>
                            <option value="industrial">Industrial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyAddress">Property Address</label>
                        <textarea id="propertyAddress" placeholder="Enter complete property address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="ownerName">Owner Name</label>
                        <input type="text" id="ownerName" placeholder="Enter property owner name" required>
                    </div>
                    <div class="form-group">
                        <label for="connectionPurpose">Purpose of Connection</label>
                        <textarea id="connectionPurpose" placeholder="Describe the purpose of water connection" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="existingConnection">Existing Connection</label>
                        <select id="existingConnection" required>
                            <option value="">Select Option</option>
                            <option value="new">New Connection</option>
                            <option value="transfer">Transfer of Connection</option>
                            <option value="reconnection">Reconnection</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="propertyProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Property Proof</p>
                            <input type="file" id="propertyProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="idProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload ID Proof</p>
                            <input type="file" id="idProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            "electricity-connection": `
                <h2 class="section-title">Electricity Connection Application</h2>
                <form id="electricityConnectionForm" class="application-form">
                    <div class="form-group">
                        <label for="connectionCategory">Connection Category</label>
                        <select id="connectionCategory" required>
                            <option value="">Select Category</option>
                            <option value="residential">Residential</option>
                            <option value="commercial">Commercial</option>
                            <option value="industrial">Industrial</option>
                            <option value="agricultural">Agricultural</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="loadRequired">Load Required (in kW)</label>
                        <input type="number" id="loadRequired" placeholder="Enter required load" required>
                    </div>
                    <div class="form-group">
                        <label for="voltageLevel">Voltage Level</label>
                        <select id="voltageLevel" required>
                            <option value="">Select Voltage Level</option>
                            <option value="lt">LT (Low Tension)</option>
                            <option value="ht">HT (High Tension)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="premisesType">Type of Premises</label>
                        <select id="premisesType" required>
                            <option value="">Select Premises Type</option>
                            <option value="owned">Owned</option>
                            <option value="rented">Rented</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="applicantName">Applicant Name</label>
                        <input type="text" id="applicantName" placeholder="Enter applicant name" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="addressProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Address Proof</p>
                            <input type="file" id="addressProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="identityProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Identity Proof</p>
                            <input type="file" id="identityProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="ownershipProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Ownership Proof</p>
                            <input type="file" id="ownershipProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            "grievance-redressal": `
                <h2 class="section-title">Grievance Redressal</h2>
                <form id="grievanceRedressalForm" class="application-form">
                    <div class="form-group">
                        <label for="grievanceType">Type of Grievance</label>
                        <select id="grievanceType" required>
                            <option value="">Select Grievance Type</option>
                            <option value="service-delay">Service Delay</option>
                            <option value="corruption">Corruption Complaint</option>
                            <option value="misbehavior">Staff Misbehavior</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="grievanceSubject">Subject</label>
                        <input type="text" id="grievanceSubject" placeholder="Enter grievance subject" required>
                    </div>
                    <div class="form-group">
                        <label for="grievanceDescription">Detailed Description</label>
                        <textarea id="grievanceDescription" placeholder="Provide detailed description of your grievance" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="department">Concerned Department</label>
                        <select id="department" required>
                            <option value="">Select Department</option>
                            <option value="licensing">Licensing Department</option>
                            <option value="tax">Tax Department</option>
                            <option value="sanitation">Sanitation Department</option>
                            <option value="water">Water Department</option>
                            <option value="electricity">Electricity Department</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="preferredResolution">Preferred Resolution</label>
                        <textarea id="preferredResolution" placeholder="What resolution are you expecting?" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Upload Supporting Documents (if any)</label>
                        <div class="file-upload-container" id="grievanceDocsUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Supporting Documents</p>
                            <input type="file" id="grievanceDocs" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Grievance</button>
                </form>
            `,
            "encumbrance-certificate": `
                <h2 class="section-title">Encumbrance Certificate Application</h2>
                <form id="encumbranceCertificateForm" class="application-form">
                    <div class="form-group">
                        <label for="propertyDetails">Property Details</label>
                        <textarea id="propertyDetails" placeholder="Enter complete property details including survey number, location, etc." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="periodFrom">Period From</label>
                        <input type="date" id="periodFrom" required>
                    </div>
                    <div class="form-group">
                        <label for="periodTo">Period To</label>
                        <input type="date" id="periodTo" required>
                    </div>
                    <div class="form-group">
                        <label for="purpose">Purpose of Certificate</label>
                        <select id="purpose" required>
                            <option value="">Select Purpose</option>
                            <option value="loan">Bank Loan</option>
                            <option value="sale">Property Sale</option>
                            <option value="legal">Legal Proceedings</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="applicantRelation">Applicant's Relation to Property</label>
                        <select id="applicantRelation" required>
                            <option value="">Select Relation</option>
                            <option value="owner">Owner</option>
                            <option value="purchaser">Prospective Purchaser</option>
                            <option value="agent">Authorized Agent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="propertyDocumentsUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Property Documents</p>
                            <input type="file" id="propertyDocuments" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="applicantIdUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Applicant ID Proof</p>
                            <input type="file" id="applicantId" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            "pension-scheme": `
                <h2 class="section-title">Pension Scheme Application</h2>
                <form id="pensionSchemeForm" class="application-form">
                    <div class="form-group">
                        <label for="schemeType">Pension Scheme Type</label>
                        <select id="schemeType" required>
                            <option value="">Select Scheme Type</option>
                            <option value="old-age">Old Age Pension</option>
                            <option value="widow">Widow Pension</option>
                            <option value="disabled">Disability Pension</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="applicantName">Applicant Name</label>
                        <input type="text" id="applicantName" placeholder="Enter applicant name" required>
                    </div>
                    <div class="form-group">
                        <label for="applicantAge">Applicant Age</label>
                        <input type="number" id="applicantAge" placeholder="Enter age" required>
                    </div>
                    <div class="form-group">
                        <label for="monthlyIncome">Monthly Income</label>
                        <input type="number" id="monthlyIncome" placeholder="Enter monthly income" required>
                    </div>
                    <div class="form-group">
                        <label for="familyMembers">Number of Family Members</label>
                        <input type="number" id="familyMembers" placeholder="Enter number of family members" required>
                    </div>
                    <div class="form-group">
                        <label for="bankDetails">Bank Account Details</label>
                        <textarea id="bankDetails" placeholder="Enter bank name, account number, and IFSC code" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="ageProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Age Proof</p>
                            <input type="file" id="ageProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="incomeProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Income Proof</p>
                            <input type="file" id="incomeProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="bankProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Bank Proof</p>
                            <input type="file" id="bankProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });

            // Service category cards
            document.querySelectorAll('.category-card[data-service]').forEach(card => {
                card.addEventListener('click', function() {
                    const service = this.getAttribute('data-service');
                    
                    // Switch to service forms section
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    document.querySelector('[data-section="services"]').classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById('service-forms').classList.add('active');
                    
                    // Load the appropriate form
                    loadServiceForm(service);
                });
            });

            // File upload functionality
            function setupFileUpload(uploadContainerId, fileInputId) {
                const uploadContainer = document.getElementById(uploadContainerId);
                const fileInput = document.getElementById(fileInputId);
                
                if (uploadContainer && fileInput) {
                    uploadContainer.addEventListener('click', function() {
                        fileInput.click();
                    });
                    
                    fileInput.addEventListener('change', function() {
                        if (this.files && this.files[0]) {
                            const previewContainer = document.getElementById('filePreview');
                            for (let i = 0; i < this.files.length; i++) {
                                const file = this.files[i];
                                const reader = new FileReader();
                                
                                reader.onload = function(e) {
                                    const previewItem = document.createElement('div');
                                    previewItem.className = 'file-preview-item';
                                    
                                    const img = document.createElement('img');
                                    img.src = e.target.result;
                                    
                                    const removeBtn = document.createElement('button');
                                    removeBtn.className = 'remove-file';
                                    removeBtn.innerHTML = '&times;';
                                    removeBtn.addEventListener('click', function() {
                                        previewItem.remove();
                                    });
                                    
                                    previewItem.appendChild(img);
                                    previewItem.appendChild(removeBtn);
                                    previewContainer.appendChild(previewItem);
                                };
                                
                                reader.readAsDataURL(file);
                            }
                        }
                    });
                }
            }

            // Load service form
            function loadServiceForm(service) {
                const formsSection = document.getElementById('service-forms');
                formsSection.innerHTML = serviceForms[service] || '<p>Form not available for this service.</p>';
                
                // Set up file uploads for the loaded form
                const fileUploadContainers = formsSection.querySelectorAll('.file-upload-container');
                fileUploadContainers.forEach(container => {
                    const fileInputId = container.querySelector('input[type="file"]').id;
                    setupFileUpload(container.id, fileInputId);
                });
                
                // Set up form submission
                const form = document.getElementById(service + 'Form');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        submitApplication(service, this);
                    });
                }
            }

            // Submit application
            function submitApplication(serviceType, form) {
                if (!currentUser) {
                    alert('Please login to submit an application.');
                    return;
                }
                
                const formData = new FormData(form);
                const applicationData = {};
                
                for (let [key, value] of formData.entries()) {
                    applicationData[key] = value;
                }
                
                const application = {
                    id: applicationIdCounter++,
                    userId: currentUser.id,
                    serviceType: serviceType,
                    data: applicationData,
                    status: 'pending',
                    date: new Date().toISOString().split('T')[0],
                    userName: currentUser.name,
                    userEmail: currentUser.email,
                    userPhone: currentUser.phone
                };
                
                applications.push(application);
                saveData();
                
                // Update user application count
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].applications = (users[userIndex].applications || 0) + 1;
                }
                
                alert(`Application submitted successfully! Your application ID is: ${application.id}`);
                form.reset();
                
                // Clear file previews
                const filePreview = document.getElementById('filePreview');
                if (filePreview) {
                    filePreview.innerHTML = '';
                }
                
                // Update application lists
                updateStats();
            }

            // Enhanced chatbot functionality
            document.getElementById('chatbotToggle').addEventListener('click', function() {
                document.getElementById('chatbotWindow').style.display = 'flex';
            });

            document.getElementById('closeChatbot').addEventListener('click', function() {
                document.getElementById('chatbotWindow').style.display = 'none';
            });

            document.getElementById('sendMessage').addEventListener('click', sendMessage);
            document.getElementById('chatbotInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            function sendMessage() {
                const input = document.getElementById('chatbotInput');
                const message = input.value.trim();
                
                if (message) {
                    // Add user message
                    addMessage(message, 'user');
                    input.value = '';
                    
                    // Generate bot response
                    setTimeout(() => {
                        const response = generateBotResponse(message);
                        addMessage(response.text, 'bot');
                        
                        // Add details if available
                        if (response.details) {
                            const detailsElement = document.createElement('div');
                            detailsElement.className = 'message bot-message';
                            detailsElement.innerHTML = response.details;
                            
                            // Add apply button if action is specified
                            if (response.action) {
                                const applyButton = document.createElement('button');
                                applyButton.className = 'apply-now-btn';
                                applyButton.textContent = 'Apply Now';
                                applyButton.onclick = function() {
                                    applyForService(response.action);
                                    document.getElementById('chatbotWindow').style.display = 'none';
                                };
                                detailsElement.appendChild(applyButton);
                            }
                            
                            document.getElementById('chatbotMessages').appendChild(detailsElement);
                        }
                        
                        // Add quick actions if available
                        if (response.quickActions) {
                            const quickActionsContainer = document.createElement('div');
                            quickActionsContainer.className = 'chatbot-quick-actions';
                            
                            response.quickActions.forEach(action => {
                                const actionButton = document.createElement('button');
                                actionButton.className = 'quick-action-btn';
                                actionButton.textContent = action;
                                actionButton.onclick = function() {
                                    document.getElementById('chatbotInput').value = action;
                                    sendMessage();
                                };
                                quickActionsContainer.appendChild(actionButton);
                            });
                            
                            document.getElementById('chatbotMessages').appendChild(quickActionsContainer);
                        }
                        
                        document.getElementById('chatbotMessages').scrollTop = document.getElementById('chatbotMessages').scrollHeight;
                    }, 500);
                }
            }

            function addMessage(text, sender) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', `${sender}-message`);
                messageElement.textContent = text;
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function generateBotResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Greeting responses
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                    return {
                        text: "Hello! I'm your municipality assistant. I can help you with:",
                        quickActions: [
                            "License Application",
                            "Property Tax Payment", 
                            "Vehicle Registration",
                            "Marriage Certificate",
                            "Water Connection",
                            "Electricity Connection",
                            "Grievance Redressal",
                            "Pension Scheme"
                        ]
                    };
                }
                
                // Marriage certificate information
                if (lowerMessage.includes('marriage') || lowerMessage.includes('marriage certificate')) {
                    return {
                        text: "For Marriage Certificate Application, here's what you need to know:",
                        details: `
                            <div class="service-steps">
                                <h4>Marriage Certificate Process:</h4>
                                <ol>
                                    <li>Fill out the marriage certificate application form</li>
                                    <li>Provide details of both husband and wife</li>
                                    <li>Enter marriage date and place information</li>
                                    <li>Provide witness details</li>
                                    <li>Upload required documents including marriage proof</li>
                                    <li>Submit application for processing</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Marriage proof (Marriage invitation, photos, etc.)</li>
                                    <li>Husband's identity and address proof</li>
                                    <li>Wife's identity and address proof</li>
                                    <li>Witness identity proofs</li>
                                    <li>Passport-sized photographs of both</li>
                                </ul>
                            </div>
                        `,
                        action: "marriage-certificate"
                    };
                }
                
                // Water connection information
                if (lowerMessage.includes('water') || lowerMessage.includes('water connection')) {
                    return {
                        text: "For Water Connection Application, here's the process:",
                        details: `
                            <div class="service-steps">
                                <h4>Water Connection Process:</h4>
                                <ol>
                                    <li>Select connection type (Domestic, Commercial, Industrial)</li>
                                    <li>Provide property address details</li>
                                    <li>Enter owner information</li>
                                    <li>Specify purpose of connection</li>
                                    <li>Indicate if it's a new connection or transfer</li>
                                    <li>Upload property and identity documents</li>
                                    <li>Submit application for approval</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Property ownership proof</li>
                                    <li>Identity proof of applicant</li>
                                    <li>Address proof</li>
                                    <li>No objection certificate (if rented property)</li>
                                </ul>
                            </div>
                        `,
                        action: "water-connection"
                    };
                }
                
                // Electricity connection information
                if (lowerMessage.includes('electricity') || lowerMessage.includes('power connection')) {
                    return {
                        text: "For Electricity Connection Application, here's what you need:",
                        details: `
                            <div class="service-steps">
                                <h4>Electricity Connection Process:</h4>
                                <ol>
                                    <li>Select connection category (Residential, Commercial, etc.)</li>
                                    <li>Specify required load and voltage level</li>
                                    <li>Provide premises type information</li>
                                    <li>Enter applicant details</li>
                                    <li>Upload address, identity and ownership proofs</li>
                                    <li>Submit application for processing</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Address proof of the premises</li>
                                    <li>Identity proof of applicant</li>
                                    <li>Ownership proof or rental agreement</li>
                                    <li>Building plan approval (if new construction)</li>
                                </ul>
                            </div>
                        `,
                        action: "electricity-connection"
                    };
                }
                
                // Grievance redressal information
                if (lowerMessage.includes('grievance') || lowerMessage.includes('complaint') || lowerMessage.includes('issue')) {
                    return {
                        text: "For Grievance Redressal, here's how it works:",
                        details: `
                            <div class="service-steps">
                                <h4>Grievance Redressal Process:</h4>
                                <ol>
                                    <li>Select type of grievance</li>
                                    <li>Provide subject and detailed description</li>
                                    <li>Specify concerned department</li>
                                    <li>Indicate preferred resolution</li>
                                    <li>Upload supporting documents if available</li>
                                    <li>Submit grievance for resolution</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Grievance Types:</h4>
                                <ul>
                                    <li>Service delays</li>
                                    <li>Corruption complaints</li>
                                    <li>Staff misbehavior</li>
                                    <li>Other service-related issues</li>
                                </ul>
                            </div>
                        `,
                        action: "grievance-redressal"
                    };
                }
                
                // Encumbrance certificate information
                if (lowerMessage.includes('encumbrance') || lowerMessage.includes('property certificate')) {
                    return {
                        text: "For Encumbrance Certificate Application, here's the procedure:",
                        details: `
                            <div class="service-steps">
                                <h4>Encumbrance Certificate Process:</h4>
                                <ol>
                                    <li>Provide complete property details</li>
                                    <li>Specify the period for which certificate is required</li>
                                    <li>Indicate purpose of the certificate</li>
                                    <li>Specify applicant's relation to property</li>
                                    <li>Upload property documents and identity proof</li>
                                    <li>Submit application for processing</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Property documents (Sale deed, etc.)</li>
                                    <li>Identity proof of applicant</li>
                                    <li>Proof of relation to property</li>
                                    <li>Previous property tax receipts</li>
                                </ul>
                            </div>
                        `,
                        action: "encumbrance-certificate"
                    };
                }
                
                // Pension scheme information
                if (lowerMessage.includes('pension') || lowerMessage.includes('senior citizen')) {
                    return {
                        text: "For Pension Scheme Application, here's what you need:",
                        details: `
                            <div class="service-steps">
                                <h4>Pension Scheme Process:</h4>
                                <ol>
                                    <li>Select type of pension scheme</li>
                                    <li>Provide applicant details including age</li>
                                    <li>Enter monthly income information</li>
                                    <li>Specify number of family members</li>
                                    <li>Provide bank account details</li>
                                    <li>Upload age, income and bank proofs</li>
                                    <li>Submit application for approval</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Age proof (Birth certificate, school certificate, etc.)</li>
                                    <li>Income proof (Income certificate, etc.)</li>
                                    <li>Bank account proof (Passbook, cancelled cheque)</li>
                                    <li>Identity and address proof</li>
                                </ul>
                            </div>
                        `,
                        action: "pension-scheme"
                    };
                }
                
                // Default response
                return {
                    text: "I'm here to help with municipality services. You can ask me about:",
                    details: `
                        <div class="service-steps">
                            <ul>
                                <li>License applications and renewals</li>
                                <li>Property tax payment process</li>
                                <li>Vehicle registration requirements</li>
                                <li>Marriage certificate applications</li>
                                <li>Water and electricity connections</li>
                                <li>Grievance redressal procedures</li>
                                <li>Encumbrance certificate applications</li>
                                <li>Pension schemes for senior citizens</li>
                            </ul>
                        </div>
                        <p>Or use the quick action buttons below for specific services!</p>
                    `,
                    quickActions: [
                        "License Application",
                        "Property Tax", 
                        "Marriage Certificate",
                        "Water Connection",
                        "Electricity Connection",
                        "Grievance Redressal",
                        "Pension Scheme"
                    ]
                };
            }

            // Apply for service from chatbot
            window.applyForService = function(service) {
                // Switch to service forms section
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelector('[data-section="services"]').classList.add('active');
                
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('service-forms').classList.add('active');
                
                // Load the appropriate form
                loadServiceForm(service);
            };

            // Initialize chatbot with welcome message and quick actions
            function initializeChatbot() {
                const welcomeResponse = generateBotResponse('hello');
                addMessage(welcomeResponse.text, 'bot');
                
                if (welcomeResponse.quickActions) {
                    const quickActionsContainer = document.createElement('div');
                    quickActionsContainer.className = 'chatbot-quick-actions';
                    
                    welcomeResponse.quickActions.forEach(action => {
                        const actionButton = document.createElement('button');
                        actionButton.className = 'quick-action-btn';
                        actionButton.textContent = action;
                        actionButton.onclick = function() {
                            document.getElementById('chatbotInput').value = action;
                            sendMessage();
                        };
                        quickActionsContainer.appendChild(actionButton);
                    });
                    
                    document.getElementById('chatbotMessages').appendChild(quickActionsContainer);
                }
            }

            // Login/Register functionality
            document.getElementById('loginBtn').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'flex';
            });

            document.getElementById('registerBtn').addEventListener('click', function() {
                const name = prompt('Enter your full name:');
                const email = prompt('Enter your email:');
                const phone = prompt('Enter your phone number:');
                
                if (name && email && phone) {
                    const newUser = {
                        id: userIdCounter++,
                        name: name,
                        email: email,
                        phone: phone,
                        status: 'active',
                        applications: 0,
                        complaints: 0
                    };
                    
                    users.push(newUser);
                    currentUser = newUser;
                    isAdmin = false;
                    saveData();
                    
                    alert(`Registration successful! Welcome, ${name}.`);
                    updateUIForUser();
                }
            });

            function updateUIForUser() {
                if (currentUser || isAdmin) {
                    document.getElementById('loginBtn').textContent = 'Logout';
                    document.getElementById('registerBtn').style.display = 'none';
                    
                    document.getElementById('loginBtn').onclick = function() {
                        currentUser = null;
                        isAdmin = false;
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('isAdmin');
                        alert('You have been logged out.');
                        location.reload();
                    };
                }
            }

            // Initialize UI
            updateStats();
            updateUIForUser();
            initializeChatbot();

            // Set up periodic updates for demo purposes
            setInterval(updateStats, 5000);
        });

        // Data management functions
        function saveData() {
            localStorage.setItem('applications', JSON.stringify(applications));
            localStorage.setItem('complaints', JSON.stringify(complaints));
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('applicationIdCounter', applicationIdCounter.toString());
            localStorage.setItem('complaintIdCounter', complaintIdCounter.toString());
            localStorage.setItem('userIdCounter', userIdCounter.toString());
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
        }

        function updateStats() {
            // Update home stats
            document.getElementById('total-applications').textContent = applications.length;
            document.getElementById('approved-applications').textContent = applications.filter(a => a.status === 'approved').length;
            document.getElementById('active-users').textContent = users.filter(u => u.status === 'active').length;
            document.getElementById('total-complaints').textContent = complaints.length;
        }
    </script>
</body>
</html>
