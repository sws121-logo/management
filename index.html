<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Municipality Complaint Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --info: #17a2b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: var(--primary);
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--secondary);
        }
        
        .logo h1 {
            font-size: 1.8rem;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        nav a:hover, nav a.active {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .user-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-secondary {
            background: var(--accent);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: none;
            position: relative;
            overflow: hidden;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .complaint-categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .category-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            border-left: 4px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }
        
        .category-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .category-icon {
            font-size: 2.5rem;
            color: var(--secondary);
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .category-card:hover .category-icon {
            transform: scale(1.2) rotate(5deg);
            color: var(--accent);
        }
        
        .complaint-form {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .complaint-list {
            display: grid;
            gap: 15px;
        }
        
        .complaint-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .complaint-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .complaint-info h3 {
            margin-bottom: 5px;
        }
        
        .complaint-meta {
            display: flex;
            gap: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-in-progress {
            background: #cce7ff;
            color: #004085;
        }
        
        .status-resolved {
            background: #d4edda;
            color: #155724;
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .chatbot-toggle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--secondary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1) rotate(10deg);
            background: var(--accent);
        }
        
        .chatbot-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 400px;
            height: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .chatbot-header {
            background: var(--primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            line-height: 1.4;
            animation: messageAppear 0.3s ease;
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            background: #f1f1f1;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .quick-reply {
            background: #e0e0e0;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-reply:hover {
            background: #d0d0d0;
        }
        
        .chatbot-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
        }
        
        .chatbot-input input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 10px 15px;
            margin-right: 10px;
        }
        
        .chatbot-input button {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .chatbot-input button:hover {
            background: var(--accent);
            transform: rotate(15deg);
        }
        
        .canvas-container {
            width: 100%;
            height: 200px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-top: 4px solid var(--secondary);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .floating-animation {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }
        
        .floating-animation:nth-child(2) {
            width: 30px;
            height: 30px;
            background: rgba(231, 76, 60, 0.1);
            animation-delay: 1s;
            top: 20%;
            left: 10%;
        }
        
        .floating-animation:nth-child(3) {
            width: 40px;
            height: 40px;
            background: rgba(46, 204, 113, 0.1);
            animation-delay: 2s;
            top: 60%;
            left: 80%;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            color: #7f8c8d;
            border-top: 1px solid #eee;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .chatbot-window {
                width: 300px;
            }
            
            .complaint-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="floating-animation"></div>
            <div class="floating-animation"></div>
            <div class="floating-animation"></div>
            <div class="floating-animation"></div>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-city"></i>
                    <h1>Municipality Services</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-section="home"><i class="fas fa-home"></i> Home</a></li>
                        <li><a href="#" class="nav-link" data-section="complaints"><i class="fas fa-exclamation-circle"></i> File Complaint</a></li>
                        <li><a href="#" class="nav-link" data-section="track-complaints"><i class="fas fa-search"></i> Track Complaints</a></li>
                        <li><a href="#" class="nav-link" data-section="services"><i class="fas fa-concierge-bell"></i> Services</a></li>
                    </ul>
                </nav>
                <div class="user-actions">
                    <button class="btn btn-primary" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Login</button>
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="home" class="section active">
            <h2 class="section-title"><i class="fas fa-home"></i> Welcome to Municipality Services</h2>
            <div class="canvas-container" id="animation-container"></div>
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-exclamation-circle stat-icon"></i>
                    <div class="stat-number" id="total-complaints">0</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle stat-icon"></i>
                    <div class="stat-number" id="resolved-complaints">0</div>
                    <div class="stat-label">Resolved Complaints</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-number" id="active-users">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-clock stat-icon"></i>
                    <div class="stat-number" id="avg-resolution">0</div>
                    <div class="stat-label">Avg. Resolution (Days)</div>
                </div>
            </div>
            <div class="complaint-categories">
                <div class="category-card" data-category="garbage">
                    <i class="fas fa-trash-alt category-icon"></i>
                    <h3>Garbage Dumping</h3>
                    <p>Report issues with garbage collection and dumping</p>
                </div>
                <div class="category-card" data-category="electricity">
                    <i class="fas fa-bolt category-icon"></i>
                    <h3>Electricity Bills</h3>
                    <p>Complaints regarding electricity billing and supply</p>
                </div>
                <div class="category-card" data-category="road">
                    <i class="fas fa-road category-icon"></i>
                    <h3>Road Construction</h3>
                    <p>Report road damage and construction issues</p>
                </div>
                <div class="category-card" data-category="water">
                    <i class="fas fa-tint category-icon"></i>
                    <h3>Water Supply</h3>
                    <p>Issues with water supply and quality</p>
                </div>
                <div class="category-card" data-category="sanitation">
                    <i class="fas fa-pump-soap category-icon"></i>
                    <h3>Sanitation</h3>
                    <p>Public sanitation and cleanliness issues</p>
                </div>
                <div class="category-card" data-category="other">
                    <i class="fas fa-question-circle category-icon"></i>
                    <h3>Other Issues</h3>
                    <p>Other municipality related complaints</p>
                </div>
            </div>
        </section>

        <!-- File Complaint Section -->
        <section id="complaints" class="section">
            <h2 class="section-title"><i class="fas fa-exclamation-circle"></i> File a Complaint</h2>
            <form id="complaintForm" class="complaint-form">
                <div class="form-group">
                    <label for="category"><i class="fas fa-tag"></i> Complaint Category</label>
                    <select id="category" required>
                        <option value="">Select a category</option>
                        <option value="garbage">Garbage Dumping</option>
                        <option value="electricity">Electricity Bills</option>
                        <option value="road">Road Construction</option>
                        <option value="water">Water Supply</option>
                        <option value="sanitation">Sanitation</option>
                        <option value="other">Other Issues</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="title"><i class="fas fa-heading"></i> Complaint Title</label>
                    <input type="text" id="title" placeholder="Brief title of your complaint" required>
                </div>
                <div class="form-group">
                    <label for="description"><i class="fas fa-align-left"></i> Complaint Description</label>
                    <textarea id="description" placeholder="Please describe your issue in detail..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="location"><i class="fas fa-map-marker-alt"></i> Location</label>
                    <input type="text" id="location" placeholder="Where is the issue located?" required>
                </div>
                <div class="form-group">
                    <label for="priority"><i class="fas fa-exclamation-triangle"></i> Priority</label>
                    <select id="priority" required>
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="urgent">Urgent</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Submit Complaint</button>
            </form>
        </section>

        <!-- Track Complaints Section -->
        <section id="track-complaints" class="section">
            <h2 class="section-title"><i class="fas fa-search"></i> Track Your Complaints</h2>
            <div class="complaint-list" id="complaintList">
                <!-- Complaint items will be dynamically added here -->
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="section">
            <h2 class="section-title"><i class="fas fa-concierge-bell"></i> Municipality Services</h2>
            <div class="complaint-categories">
                <div class="category-card">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>Birth/Death Certificate</h3>
                    <p>Apply for birth and death certificates</p>
                </div>
                <div class="category-card">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card">
                    <i class="fas fa-tree category-icon"></i>
                    <h3>Park Maintenance</h3>
                    <p>Maintenance of public parks and gardens</p>
                </div>
                <div class="category-card">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permits</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card">
                    <i class="fas fa-phone-alt category-icon"></i>
                    <h3>Helpline Numbers</h3>
                    <p>Emergency and service helpline numbers</p>
                </div>
            </div>
        </section>

        <!-- Chatbot -->
        <div class="chatbot-container">
            <div class="chatbot-toggle" id="chatbotToggle">
                <i class="fas fa-comments"></i>
            </div>
            <div class="chatbot-window" id="chatbotWindow">
                <div class="chatbot-header">
                    <h3>Municipality Assistant</h3>
                    <button id="closeChatbot"><i class="fas fa-times"></i></button>
                </div>
                <div class="chatbot-messages" id="chatbotMessages">
                    <div class="message bot-message">
                        Hello! I'm your municipality assistant. How can I help you today?
                        <div class="quick-replies">
                            <button class="quick-reply" data-query="file complaint">File Complaint</button>
                            <button class="quick-reply" data-query="track complaint">Track Complaint</button>
                            <button class="quick-reply" data-query="services">Services Info</button>
                            <button class="quick-reply" data-query="contact">Contact Info</button>
                        </div>
                    </div>
                </div>
                <div class="chatbot-input">
                    <input type="text" id="chatbotInput" placeholder="Type your message...">
                    <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2023 Municipality Services. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Sample data for the application
        let complaints = JSON.parse(localStorage.getItem('complaints')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, name: "John Doe", email: "john@example.com", phone: "1234567890", password: "password123", status: "active", complaints: 2 }
        ];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let complaintIdCounter = parseInt(localStorage.getItem('complaintIdCounter')) || 1001;

        // Enhanced chatbot knowledge base
        const chatbotKnowledge = {
            "greeting": [
                "Hello! How can I assist you with municipality services today?",
                "Hi there! I'm here to help with any municipality-related queries.",
                "Welcome! How can I help you with our municipality services?"
            ],
            "file complaint": [
                "To file a complaint, go to the 'File Complaint' section. Select a category like Garbage, Electricity, Road, Water, Sanitation, or Other. Fill in the details including title, description, location, and priority level.",
                "You can file complaints by navigating to the File Complaint tab. Choose the appropriate category for your issue and provide as much detail as possible.",
                "For filing complaints: 1) Click on 'File Complaint' in the menu 2) Select complaint category 3) Fill in all required details 4) Submit the form. You'll receive a complaint ID for tracking."
            ],
            "track complaint": [
                "To track your complaints, go to the 'Track Complaints' section. You'll see all your submitted complaints with their current status (Pending, In Progress, or Resolved).",
                "Check your complaint status in the Track Complaints section. Each complaint shows its ID, category, submission date, and current status.",
                "You can monitor your complaint progress in the Track Complaints tab. If you need updates on a specific complaint, provide the complaint ID and I can check its status."
            ],
            "garbage": [
                "For garbage-related issues: Report missed collections, overflowing bins, illegal dumping, or street cleaning needs. Provide specific location details for faster resolution.",
                "Garbage complaints typically get resolved within 2-3 business days. Emergency sanitation issues are prioritized.",
                "Our sanitation department operates Monday-Saturday. For urgent garbage issues, call our helpline at 1800-123-4567."
            ],
            "electricity": [
                "For electricity issues: Report power outages, billing problems, meter issues, or electrical hazards. Have your account number ready when filing complaints.",
                "Electricity complaints are handled by our utilities department. Power outage reports get highest priority and are usually addressed within 2 hours.",
                "For electricity bill disputes, you'll need to provide your consumer number and last bill details. Our team will verify and resolve within 5 business days."
            ],
            "road": [
                "For road issues: Report potholes, damaged roads, missing signage, traffic signal problems, or construction complaints. Include exact location and photos if possible.",
                "Road maintenance complaints are categorized by severity. Critical safety issues are addressed within 24 hours, while general repairs may take 3-7 days.",
                "Our public works department handles road complaints. For emergency road hazards, call 1800-123-4567 immediately."
            ],
            "water": [
                "For water issues: Report supply interruptions, low pressure, water quality concerns, leaking pipes, or billing problems. Provide your address and water connection details.",
                "Water supply complaints are prioritized based on affected area size. Individual issues are typically resolved within 48 hours.",
                "For water quality testing or major pipe leaks, our team responds within 4 hours. Have your water account number ready when reporting issues."
            ],
            "sanitation": [
                "For sanitation issues: Report public toilet maintenance, drainage problems, street cleaning, or public health concerns. Specific location details help us respond faster.",
                "Sanitation complaints are handled by our health department. Most issues are resolved within 3 business days.",
                "Public sanitation is monitored daily. For urgent health hazards, we respond within 2 hours of complaint registration."
            ],
            "services": [
                "Our municipality services include: Birth/Death Certificates, Property Tax payments, Vehicle Registration, Park Maintenance, Building Permits, and various public utilities.",
                "You can access multiple services through our portal: Certificate applications, tax payments, permit requests, and utility services are all available online.",
                "Service hours: Monday-Friday 9AM-5PM, Saturday 9AM-1PM. Online services available 24/7. Visit the Services section for detailed information."
            ],
            "contact": [
                "Main Helpline: 1800-123-4567 (24/7)<br>Emergency: 911<br>Email: contact@municipality.gov<br>Office Hours: Mon-Fri 9AM-5PM",
                "Department Contacts:<br>Sanitation: Ext. 101<br>Electricity: Ext. 102<br>Water: Ext. 103<br>Roads: Ext. 104<br>General Inquiries: Ext. 100",
                "Visit our office at: 123 Civic Center, Main City. You can also reach us through our website or mobile app for faster service."
            ],
            "complaint status": [
                "Complaint status can be: Pending (just submitted), In Progress (being reviewed), or Resolved (completed). Typical resolution time varies by category.",
                "Status meanings:<br>- Pending: Awaiting review<br>- In Progress: Assigned to department<br>- Resolved: Completed successfully",
                "You can check your complaint status in the Track Complaints section. If your complaint is taking longer than expected, contact our helpline with your complaint ID."
            ],
            "processing time": [
                "Average processing times:<br>- Garbage: 2-3 days<br>- Electricity: 1-2 days<br>- Road: 3-7 days<br>- Water: 2-4 days<br>- Sanitation: 3-5 days<br>Urgent issues are prioritized.",
                "Processing times depend on complaint complexity and department workload. Emergency issues are addressed within hours.",
                "Most complaints are resolved within 5 business days. You'll receive notifications when status changes."
            ],
            "helpline": [
                "Our 24/7 helpline number is 1800-123-4567. For emergencies, dial 911 immediately.",
                "Contact us at 1800-123-4567 for any municipality service queries. Department-specific extensions available.",
                "Helpline: 1800-123-4567 (24/7)<br>Email: support@municipality.gov<br>Live chat available on our website during business hours."
            ],
            "office hours": [
                "Municipality office hours: Monday to Friday 9:00 AM - 5:00 PM, Saturday 9:00 AM - 1:00 PM. Closed on Sundays and public holidays.",
                "Our offices are open Weekdays 9AM-5PM, Saturdays 9AM-1PM. Online services available 24/7.",
                "Service counters: Mon-Fri 9AM-5PM, Sat 9AM-1PM. Online portal accessible anytime for complaints and service requests."
            ],
            "documents required": [
                "For most services, you'll need: ID proof, address proof, and relevant application forms. Specific requirements vary by service type.",
                "Common documents: Aadhaar/Passport/Driving License for ID proof, utility bills for address proof. Check specific service requirements in the Services section.",
                "Document requirements depend on the service. Generally, bring government-issued ID and address proof. Our staff can guide you for specific services."
            ],
            "default": [
                "I'm here to help with municipality services. You can ask me about filing complaints, tracking status, service information, or contact details.",
                "I specialize in municipality services. How can I assist you with complaints, services, or general information?",
                "I can help you with complaint filing, status tracking, service information, or contact details. What do you need help with?"
            ]
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize 3D animation
            init3DAnimation();
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });

            // Category cards
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    if (category) {
                        // Switch to complaints section and set category
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        document.querySelector('[data-section="complaints"]').classList.add('active');
                        
                        document.querySelectorAll('.section').forEach(section => {
                            section.classList.remove('active');
                        });
                        document.getElementById('complaints').classList.add('active');
                        
                        document.getElementById('category').value = category;
                    }
                });
            });

            // Complaint form submission
            document.getElementById('complaintForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    alert('Please login to submit a complaint.');
                    return;
                }
                
                const complaint = {
                    id: complaintIdCounter++,
                    userId: currentUser.id,
                    category: document.getElementById('category').value,
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    location: document.getElementById('location').value,
                    priority: document.getElementById('priority').value,
                    status: 'pending',
                    date: new Date().toISOString().split('T')[0],
                    userName: currentUser.name,
                    userEmail: currentUser.email,
                    userPhone: currentUser.phone
                };
                
                complaints.push(complaint);
                saveData();
                
                // Update user complaint count
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].complaints = (users[userIndex].complaints || 0) + 1;
                }
                
                alert(`Complaint submitted successfully! Your complaint ID is: ${complaint.id}`);
                this.reset();
                
                // Update complaint lists
                updateComplaintList();
                updateStats();
            });

            // Chatbot functionality
            document.getElementById('chatbotToggle').addEventListener('click', function() {
                document.getElementById('chatbotWindow').style.display = 'flex';
            });

            document.getElementById('closeChatbot').addEventListener('click', function() {
                document.getElementById('chatbotWindow').style.display = 'none';
            });

            document.getElementById('sendMessage').addEventListener('click', sendMessage);
            document.getElementById('chatbotInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Quick reply buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('quick-reply')) {
                    const query = e.target.getAttribute('data-query');
                    document.getElementById('chatbotInput').value = query;
                    sendMessage();
                }
            });

            function sendMessage() {
                const input = document.getElementById('chatbotInput');
                const message = input.value.trim();
                
                if (message) {
                    // Add user message
                    addMessage(message, 'user');
                    input.value = '';
                    
                    // Generate bot response
                    setTimeout(() => {
                        const response = generateBotResponse(message);
                        addMessage(response, 'bot');
                    }, 500);
                }
            }

            function addMessage(text, sender) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', `${sender}-message`);
                
                if (sender === 'bot' && text.includes('<br>')) {
                    // For bot messages with line breaks
                    messageElement.innerHTML = text;
                    
                    // Add quick replies for certain responses
                    if (text.includes('How can I assist you') || text.includes('What do you need help with')) {
                        const quickReplies = document.createElement('div');
                        quickReplies.className = 'quick-replies';
                        quickReplies.innerHTML = `
                            <button class="quick-reply" data-query="file complaint">File Complaint</button>
                            <button class="quick-reply" data-query="track complaint">Track Complaint</button>
                            <button class="quick-reply" data-query="services">Services Info</button>
                            <button class="quick-reply" data-query="contact">Contact Info</button>
                        `;
                        messageElement.appendChild(quickReplies);
                    }
                } else {
                    messageElement.textContent = text;
                }
                
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function generateBotResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Check for specific categories and keywords
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                    return getRandomResponse('greeting');
                } else if (lowerMessage.includes('file') && lowerMessage.includes('complaint')) {
                    return getRandomResponse('file complaint');
                } else if (lowerMessage.includes('track') && lowerMessage.includes('complaint')) {
                    return getRandomResponse('track complaint');
                } else if (lowerMessage.includes('status') && lowerMessage.includes('complaint')) {
                    return getRandomResponse('complaint status');
                } else if (lowerMessage.includes('garbage') || lowerMessage.includes('trash') || lowerMessage.includes('waste')) {
                    return getRandomResponse('garbage');
                } else if (lowerMessage.includes('electricity') || lowerMessage.includes('power') || lowerMessage.includes('bill')) {
                    return getRandomResponse('electricity');
                } else if (lowerMessage.includes('road') || lowerMessage.includes('pothole') || lowerMessage.includes('street')) {
                    return getRandomResponse('road');
                } else if (lowerMessage.includes('water') || lowerMessage.includes('supply') || lowerMessage.includes('pipe')) {
                    return getRandomResponse('water');
                } else if (lowerMessage.includes('sanitation') || lowerMessage.includes('clean') || lowerMessage.includes('drain')) {
                    return getRandomResponse('sanitation');
                } else if (lowerMessage.includes('service') || lowerMessage.includes('certificate') || lowerMessage.includes('tax') || lowerMessage.includes('permit')) {
                    return getRandomResponse('services');
                } else if (lowerMessage.includes('contact') || lowerMessage.includes('number') || lowerMessage.includes('phone') || lowerMessage.includes('email')) {
                    return getRandomResponse('contact');
                } else if (lowerMessage.includes('helpline') || lowerMessage.includes('emergency')) {
                    return getRandomResponse('helpline');
                } else if (lowerMessage.includes('time') || lowerMessage.includes('process') || lowerMessage.includes('duration')) {
                    return getRandomResponse('processing time');
                } else if (lowerMessage.includes('hour') || lowerMessage.includes('open') || lowerMessage.includes('close')) {
                    return getRandomResponse('office hours');
                } else if (lowerMessage.includes('document') || lowerMessage.includes('require') || lowerMessage.includes('need')) {
                    return getRandomResponse('documents required');
                } else {
                    return getRandomResponse('default');
                }
            }

            function getRandomResponse(category) {
                const responses = chatbotKnowledge[category];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            // Login functionality
            document.getElementById('loginBtn').addEventListener('click', function() {
                if (currentUser) {
                    // Logout
                    currentUser = null;
                    localStorage.removeItem('currentUser');
                    this.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                    updateComplaintList();
                    alert('You have been logged out.');
                } else {
                    // Simple login for demo - in real app, this would be more secure
                    const email = prompt('Enter your email:');
                    if (email) {
                        let user = users.find(u => u.email === email);
                        if (user) {
                            currentUser = user;
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));
                            this.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                            alert(`Welcome back, ${user.name}!`);
                            updateComplaintList();
                        } else {
                            // Auto-register if user doesn't exist
                            const name = prompt('New user detected. Enter your full name:');
                            const phone = prompt('Enter your phone number:');
                            
                            if (name && phone) {
                                const newUser = {
                                    id: users.length + 1,
                                    name: name,
                                    email: email,
                                    phone: phone,
                                    password: 'default123',
                                    status: 'active',
                                    complaints: 0
                                };
                                
                                users.push(newUser);
                                currentUser = newUser;
                                saveData();
                                
                                this.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
                                alert(`Registration successful! Welcome, ${name}.`);
                                updateComplaintList();
                            }
                        }
                    }
                }
            });

            // Initialize UI
            updateComplaintList();
            updateStats();
            updateUIForUser();

            // Set up periodic updates for demo purposes
            setInterval(updateStats, 5000);
        });

        // Data management functions
        function saveData() {
            localStorage.setItem('complaints', JSON.stringify(complaints));
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('complaintIdCounter', complaintIdCounter.toString());
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
        }

        function updateComplaintList() {
            const complaintList = document.getElementById('complaintList');
            complaintList.innerHTML = '';
            
            let userComplaints = complaints;
            if (currentUser) {
                userComplaints = complaints.filter(c => c.userId === currentUser.id);
            }
            
            if (userComplaints.length === 0) {
                complaintList.innerHTML = '<p>No complaints found. ' + (currentUser ? '<a href="#" class="nav-link" data-section="complaints">File a complaint</a>' : 'Please login to view complaints.') + '</p>';
                return;
            }
            
            userComplaints.forEach(complaint => {
                const complaintItem = document.createElement('div');
                complaintItem.className = 'complaint-item';
                
                const statusClass = `status-${complaint.status.replace(' ', '-')}`;
                
                complaintItem.innerHTML = `
                    <div class="complaint-info">
                        <h3>${complaint.title} (ID: ${complaint.id})</h3>
                        <p>${complaint.description}</p>
                        <div class="complaint-meta">
                            <span><i class="fas fa-calendar"></i> ${complaint.date}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${complaint.location}</span>
                            <span><i class="fas fa-tag"></i> ${complaint.category}</span>
                            <span><i class="fas fa-flag"></i> ${complaint.priority}</span>
                        </div>
                    </div>
                    <div class="complaint-status">
                        <span class="status ${statusClass}">${complaint.status}</span>
                    </div>
                `;
                
                complaintList.appendChild(complaintItem);
            });
        }

        function updateStats() {
            document.getElementById('total-complaints').textContent = complaints.length;
            document.getElementById('resolved-complaints').textContent = complaints.filter(c => c.status === 'resolved').length;
            document.getElementById('active-users').textContent = users.filter(u => u.status === 'active').length;
            document.getElementById('avg-resolution').textContent = '2.5';
        }

        function updateUIForUser() {
            if (currentUser) {
                document.getElementById('loginBtn').innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
            }
        }

        // Enhanced 3D Animation using Three.js
        function init3DAnimation() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // Create scene
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf5f7fa);
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // Create city buildings
            const buildings = [];
            const buildingColors = [0x3498db, 0x2ecc71, 0xe74c3c, 0xf39c12, 0x9b59b6];
            
            for (let i = 0; i < 15; i++) {
                const width = Math.random() * 2 + 1;
                const height = Math.random() * 3 + 2;
                const depth = Math.random() * 2 + 1;
                
                const geometry = new THREE.BoxGeometry(width, height, depth);
                const color = buildingColors[Math.floor(Math.random() * buildingColors.length)];
                const material = new THREE.MeshPhongMaterial({ color: color });
                const building = new THREE.Mesh(geometry, material);
                
                building.position.x = (Math.random() - 0.5) * 20;
                building.position.z = (Math.random() - 0.5) * 20;
                building.position.y = height / 2;
                
                scene.add(building);
                buildings.push(building);
            }
            
            // Add ground
            const groundGeometry = new THREE.PlaneGeometry(30, 30);
            const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x95a5a6, side: THREE.DoubleSide });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = Math.PI / 2;
            ground.position.y = -1;
            scene.add(ground);
            
            // Position camera
            camera.position.z = 15;
            camera.position.y = 5;
            
            // Add orbit controls for interactive viewing
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                // Rotate buildings slightly for dynamic effect
                buildings.forEach(building => {
                    building.rotation.y += 0.005;
                });
                
                controls.update();
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', function() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }
    </script>
</body>
</html>
