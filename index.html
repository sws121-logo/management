<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Municipality Services Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* All existing CSS styles remain the same */
        /* Adding new styles for additional services */
        .service-steps {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .service-steps h4 {
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .service-steps ol {
            padding-left: 20px;
        }
        
        .service-steps li {
            margin-bottom: 5px;
        }
        
        .document-list {
            background: #fff3cd;
            border-radius: 5px;
            padding: 8px;
            margin: 5px 0;
        }
        
        .document-list ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .apply-now-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-top: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .chatbot-quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .quick-action-btn {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .quick-action-btn:hover {
            background: #2980b9;
        }
        
        /* All other existing CSS styles remain unchanged */
        /* ... (all previous CSS code) ... */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-city"></i>
                    <h1>Municipality Services Portal</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-section="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-section="services">Services</a></li>
                        <li><a href="#" class="nav-link" data-section="complaints">File Complaint</a></li>
                        <li><a href="#" class="nav-link" data-section="my-applications">My Applications</a></li>
                        <li><a href="#" class="nav-link" data-section="my-complaints">My Complaints</a></li>
                        <li><a href="#" class="nav-link" data-section="documentation">Documentation</a></li>
                        <li><a href="#" class="nav-link" data-section="admin">Admin Panel</a></li>
                    </ul>
                </nav>
                <div class="user-actions">
                    <button class="btn btn-primary" id="loginBtn">Login</button>
                    <button class="btn btn-secondary" id="registerBtn">Register</button>
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="home" class="section active">
            <h2 class="section-title">Welcome to Municipality Services Portal</h2>
            <div class="canvas-container" id="animation-container"></div>
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-file-alt stat-icon"></i>
                    <div class="stat-number" id="total-applications">0</div>
                    <div class="stat-label">Total Applications</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-check-circle stat-icon"></i>
                    <div class="stat-number" id="approved-applications">0</div>
                    <div class="stat-label">Approved Applications</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-number" id="active-users">0</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-exclamation-triangle stat-icon"></i>
                    <div class="stat-number" id="total-complaints">0</div>
                    <div class="stat-label">Total Complaints</div>
                </div>
            </div>
            <div class="service-categories">
                <div class="category-card" data-service="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Apply for various licenses including business, trade, and professional licenses</p>
                </div>
                <div class="category-card" data-service="license-renewal">
                    <i class="fas fa-sync-alt category-icon"></i>
                    <h3>License Renewal</h3>
                    <p>Renew your existing licenses with updated information</p>
                </div>
                <div class="category-card" data-service="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card" data-service="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card" data-service="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Apply for trade licenses for your business</p>
                </div>
                <div class="category-card" data-service="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card" data-service="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Apply for birth certificates</p>
                </div>
                <div class="category-card" data-service="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Apply for death certificates</p>
                </div>
                <!-- NEW SERVICES ADDED -->
                <div class="category-card" data-service="water-connection">
                    <i class="fas fa-tint category-icon"></i>
                    <h3>Water Connection</h3>
                    <p>Apply for new water connection or transfer existing connection</p>
                </div>
                <div class="category-card" data-service="electricity-connection">
                    <i class="fas fa-bolt category-icon"></i>
                    <h3>Electricity Connection</h3>
                    <p>Apply for new electricity connection or transfer existing connection</p>
                </div>
                <div class="category-card" data-service="marriage-certificate">
                    <i class="fas fa-ring category-icon"></i>
                    <h3>Marriage Certificate</h3>
                    <p>Apply for marriage certificate registration</p>
                </div>
                <div class="category-card" data-service="pet-license">
                    <i class="fas fa-paw category-icon"></i>
                    <h3>Pet License</h3>
                    <p>Register and license your pets with the municipality</p>
                </div>
                <div class="category-card" data-service="event-permit">
                    <i class="fas fa-calendar-alt category-icon"></i>
                    <h3>Event Permit</h3>
                    <p>Apply for permits for public events and gatherings</p>
                </div>
                <div class="category-card" data-service="encumbrance-certificate">
                    <i class="fas fa-file-contract category-icon"></i>
                    <h3>Encumbrance Certificate</h3>
                    <p>Apply for property encumbrance certificates</p>
                </div>
                <div class="category-card" data-service="pension">
                    <i class="fas fa-hand-holding-usd category-icon"></i>
                    <h3>Pension Services</h3>
                    <p>Apply for pension and related services</p>
                </div>
                <div class="category-card" data-service="public-health">
                    <i class="fas fa-heartbeat category-icon"></i>
                    <h3>Public Health Services</h3>
                    <p>Access public health services and information</p>
                </div>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="section">
            <h2 class="section-title">Municipality Services</h2>
            <div class="service-categories">
                <div class="category-card" data-service="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Apply for various licenses including business, trade, and professional licenses</p>
                </div>
                <div class="category-card" data-service="license-renewal">
                    <i class="fas fa-sync-alt category-icon"></i>
                    <h3>License Renewal</h3>
                    <p>Renew your existing licenses with updated information</p>
                </div>
                <div class="category-card" data-service="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Pay property tax and related services</p>
                </div>
                <div class="category-card" data-service="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Vehicle registration and related services</p>
                </div>
                <div class="category-card" data-service="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Apply for trade licenses for your business</p>
                </div>
                <div class="category-card" data-service="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Apply for building permits and approvals</p>
                </div>
                <div class="category-card" data-service="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Apply for birth certificates</p>
                </div>
                <div class="category-card" data-service="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Apply for death certificates</p>
                </div>
                <!-- NEW SERVICES ADDED -->
                <div class="category-card" data-service="water-connection">
                    <i class="fas fa-tint category-icon"></i>
                    <h3>Water Connection</h3>
                    <p>Apply for new water connection or transfer existing connection</p>
                </div>
                <div class="category-card" data-service="electricity-connection">
                    <i class="fas fa-bolt category-icon"></i>
                    <h3>Electricity Connection</h3>
                    <p>Apply for new electricity connection or transfer existing connection</p>
                </div>
                <div class="category-card" data-service="marriage-certificate">
                    <i class="fas fa-ring category-icon"></i>
                    <h3>Marriage Certificate</h3>
                    <p>Apply for marriage certificate registration</p>
                </div>
                <div class="category-card" data-service="pet-license">
                    <i class="fas fa-paw category-icon"></i>
                    <h3>Pet License</h3>
                    <p>Register and license your pets with the municipality</p>
                </div>
                <div class="category-card" data-service="event-permit">
                    <i class="fas fa-calendar-alt category-icon"></i>
                    <h3>Event Permit</h3>
                    <p>Apply for permits for public events and gatherings</p>
                </div>
                <div class="category-card" data-service="encumbrance-certificate">
                    <i class="fas fa-file-contract category-icon"></i>
                    <h3>Encumbrance Certificate</h3>
                    <p>Apply for property encumbrance certificates</p>
                </div>
                <div class="category-card" data-service="pension">
                    <i class="fas fa-hand-holding-usd category-icon"></i>
                    <h3>Pension Services</h3>
                    <p>Apply for pension and related services</p>
                </div>
                <div class="category-card" data-service="public-health">
                    <i class="fas fa-heartbeat category-icon"></i>
                    <h3>Public Health Services</h3>
                    <p>Access public health services and information</p>
                </div>
            </div>
        </section>

        <!-- File Complaint Section -->
        <section id="complaints" class="section">
            <h2 class="section-title">File a Complaint</h2>
            <p>Report issues and problems in your area to the municipality</p>
            
            <div class="complaint-categories">
                <div class="complaint-category" data-complaint-type="sanitation">
                    <h3><i class="fas fa-trash"></i> Sanitation Issues</h3>
                    <p>Report garbage collection problems, overflowing bins, or unclean public areas</p>
                </div>
                <div class="complaint-category" data-complaint-type="roads">
                    <h3><i class="fas fa-road"></i> Road & Infrastructure</h3>
                    <p>Report potholes, damaged roads, street light issues, or traffic problems</p>
                </div>
                <div class="complaint-category" data-complaint-type="water">
                    <h3><i class="fas fa-tint"></i> Water Supply</h3>
                    <p>Report water supply issues, leakages, or water quality problems</p>
                </div>
                <div class="complaint-category" data-complaint-type="electricity">
                    <h3><i class="fas fa-bolt"></i> Electricity Issues</h3>
                    <p>Report power outages, electrical hazards, or street light malfunctions</p>
                </div>
                <div class="complaint-category" data-complaint-type="parks">
                    <h3><i class="fas fa-tree"></i> Parks & Public Spaces</h3>
                    <p>Report issues with public parks, playgrounds, or recreational facilities</p>
                </div>
                <div class="complaint-category" data-complaint-type="noise">
                    <h3><i class="fas fa-volume-up"></i> Noise Pollution</h3>
                    <p>Report excessive noise from construction, events, or commercial establishments</p>
                </div>
            </div>
            
            <div class="complaint-form-container" id="complaintFormContainer" style="display: none;">
                <h3 id="complaintFormTitle">File Complaint</h3>
                <form id="complaintForm" class="application-form">
                    <div class="form-group">
                        <label for="complaintTitle">Complaint Title</label>
                        <input type="text" id="complaintTitle" placeholder="Brief description of the issue" required>
                    </div>
                    <div class="form-group">
                        <label for="complaintDescription">Detailed Description</label>
                        <textarea id="complaintDescription" placeholder="Provide detailed information about the issue, location, and impact" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="complaintLocation">Location</label>
                        <input type="text" id="complaintLocation" placeholder="Exact location or address of the issue" required>
                    </div>
                    <div class="form-group">
                        <label for="complaintPriority">Priority Level</label>
                        <select id="complaintPriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low - Minor inconvenience</option>
                            <option value="medium">Medium - Needs attention</option>
                            <option value="high">High - Urgent attention required</option>
                            <option value="critical">Critical - Safety hazard</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Upload Supporting Documents/Photos</label>
                        <div class="file-upload-container" id="complaintPhotoUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload photos or documents</p>
                            <input type="file" id="complaintPhoto" accept="image/*" style="display: none;" multiple>
                        </div>
                        <div class="file-preview" id="complaintFilePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Complaint</button>
                </form>
            </div>
        </section>

        <!-- Service Application Forms -->
        <section id="service-forms" class="section">
            <!-- Forms will be dynamically loaded here based on service selection -->
        </section>

        <!-- My Applications Section -->
        <section id="my-applications" class="section">
            <h2 class="section-title">My Applications</h2>
            <div class="application-list" id="applicationList">
                <!-- Application items will be dynamically added here -->
            </div>
        </section>

        <!-- My Complaints Section -->
        <section id="my-complaints" class="section">
            <h2 class="section-title">My Complaints</h2>
            <div class="complaint-list" id="complaintList">
                <!-- Complaint items will be dynamically added here -->
            </div>
        </section>

        <!-- Documentation Section -->
        <section id="documentation" class="section">
            <h2 class="section-title">Documentation Requirements</h2>
            <div class="documentation-info">
                <h3>General Documents Required for All Services</h3>
                <ul>
                    <li>Proof of Identity (Aadhar Card, Passport, Voter ID, etc.)</li>
                    <li>Proof of Address (Aadhar Card, Utility Bill, Rental Agreement, etc.)</li>
                    <li>Passport-sized Photographs</li>
                    <li>Any existing relevant certificates or licenses</li>
                </ul>
            </div>
            <div class="service-categories">
                <div class="category-card" data-doc="license">
                    <i class="fas fa-id-card category-icon"></i>
                    <h3>License Application</h3>
                    <p>Documentation requirements for license applications</p>
                    <button class="apply-now-btn" data-service="license">Apply Now</button>
                </div>
                <div class="category-card" data-doc="property-tax">
                    <i class="fas fa-home category-icon"></i>
                    <h3>Property Tax</h3>
                    <p>Documentation requirements for property tax</p>
                    <button class="apply-now-btn" data-service="property-tax">Apply Now</button>
                </div>
                <div class="category-card" data-doc="vehicle-registration">
                    <i class="fas fa-car category-icon"></i>
                    <h3>Vehicle Registration</h3>
                    <p>Documentation requirements for vehicle registration</p>
                    <button class="apply-now-btn" data-service="vehicle-registration">Apply Now</button>
                </div>
                <div class="category-card" data-doc="trade-license">
                    <i class="fas fa-store category-icon"></i>
                    <h3>Trade License</h3>
                    <p>Documentation requirements for trade license</p>
                    <button class="apply-now-btn" data-service="trade-license">Apply Now</button>
                </div>
                <div class="category-card" data-doc="building-permit">
                    <i class="fas fa-hard-hat category-icon"></i>
                    <h3>Building Permit</h3>
                    <p>Documentation requirements for building permit</p>
                    <button class="apply-now-btn" data-service="building-permit">Apply Now</button>
                </div>
                <div class="category-card" data-doc="birth-certificate">
                    <i class="fas fa-baby category-icon"></i>
                    <h3>Birth Certificate</h3>
                    <p>Documentation requirements for birth certificate</p>
                    <button class="apply-now-btn" data-service="birth-certificate">Apply Now</button>
                </div>
                <div class="category-card" data-doc="death-certificate">
                    <i class="fas fa-cross category-icon"></i>
                    <h3>Death Certificate</h3>
                    <p>Documentation requirements for death certificate</p>
                    <button class="apply-now-btn" data-service="death-certificate">Apply Now</button>
                </div>
                <!-- NEW SERVICES DOCUMENTATION -->
                <div class="category-card" data-doc="water-connection">
                    <i class="fas fa-tint category-icon"></i>
                    <h3>Water Connection</h3>
                    <p>Documentation requirements for water connection</p>
                    <button class="apply-now-btn" data-service="water-connection">Apply Now</button>
                </div>
                <div class="category-card" data-doc="electricity-connection">
                    <i class="fas fa-bolt category-icon"></i>
                    <h3>Electricity Connection</h3>
                    <p>Documentation requirements for electricity connection</p>
                    <button class="apply-now-btn" data-service="electricity-connection">Apply Now</button>
                </div>
                <div class="category-card" data-doc="marriage-certificate">
                    <i class="fas fa-ring category-icon"></i>
                    <h3>Marriage Certificate</h3>
                    <p>Documentation requirements for marriage certificate</p>
                    <button class="apply-now-btn" data-service="marriage-certificate">Apply Now</button>
                </div>
                <div class="category-card" data-doc="pet-license">
                    <i class="fas fa-paw category-icon"></i>
                    <h3>Pet License</h3>
                    <p>Documentation requirements for pet license</p>
                    <button class="apply-now-btn" data-service="pet-license">Apply Now</button>
                </div>
                <div class="category-card" data-doc="event-permit">
                    <i class="fas fa-calendar-alt category-icon"></i>
                    <h3>Event Permit</h3>
                    <p>Documentation requirements for event permit</p>
                    <button class="apply-now-btn" data-service="event-permit">Apply Now</button>
                </div>
                <div class="category-card" data-doc="encumbrance-certificate">
                    <i class="fas fa-file-contract category-icon"></i>
                    <h3>Encumbrance Certificate</h3>
                    <p>Documentation requirements for encumbrance certificate</p>
                    <button class="apply-now-btn" data-service="encumbrance-certificate">Apply Now</button>
                </div>
                <div class="category-card" data-doc="pension">
                    <i class="fas fa-hand-holding-usd category-icon"></i>
                    <h3>Pension Services</h3>
                    <p>Documentation requirements for pension services</p>
                    <button class="apply-now-btn" data-service="pension">Apply Now</button>
                </div>
                <div class="category-card" data-doc="public-health">
                    <i class="fas fa-heartbeat category-icon"></i>
                    <h3>Public Health Services</h3>
                    <p>Documentation requirements for public health services</p>
                    <button class="apply-now-btn" data-service="public-health">Apply Now</button>
                </div>
            </div>
        </section>

        <!-- Documentation Details Section -->
        <section id="documentation-details" class="section">
            <!-- Documentation details will be dynamically loaded here -->
        </section>

        <!-- Admin Panel Section -->
        <section id="admin" class="section">
            <h2 class="section-title">Admin Panel</h2>
            <div class="admin-panel">
                <div class="admin-sidebar">
                    <ul>
                        <li><a href="#" class="admin-nav active" data-tab="dashboard">Dashboard</a></li>
                        <li><a href="#" class="admin-nav" data-tab="applications-management">Applications Management</a></li>
                        <li><a href="#" class="admin-nav" data-tab="complaints-management">Complaints Management</a></li>
                        <li><a href="#" class="admin-nav" data-tab="user-management">User Management</a></li>
                        <li><a href="#" class="admin-nav" data-tab="reports">Reports & Analytics</a></li>
                        <li><a href="#" class="admin-nav" data-tab="settings">Settings</a></li>
                    </ul>
                </div>
                <div class="admin-content">
                    <div id="admin-dashboard" class="admin-tab active">
                        <h3>Admin Dashboard</h3>
                        <div class="stats-cards">
                            <div class="stat-card">
                                <i class="fas fa-file-alt stat-icon"></i>
                                <div class="stat-number" id="admin-total-applications">0</div>
                                <div class="stat-label">Total Applications</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-check-circle stat-icon"></i>
                                <div class="stat-number" id="admin-approved-applications">0</div>
                                <div class="stat-label">Approved Applications</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-exclamation-triangle stat-icon"></i>
                                <div class="stat-number" id="admin-total-complaints">0</div>
                                <div class="stat-label">Total Complaints</div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-users stat-icon"></i>
                                <div class="stat-number" id="admin-total-users">0</div>
                                <div class="stat-label">Registered Users</div>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="chart-container">
                                <h4 class="chart-title">Applications by Status</h4>
                                <div class="chart-wrapper">
                                    <canvas id="applicationsByStatusChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <h4 class="chart-title">Complaints by Type</h4>
                                <div class="chart-wrapper">
                                    <canvas id="complaintsByTypeChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 class="chart-title">Applications Over Time</h4>
                            <div class="chart-wrapper">
                                <canvas id="applicationsOverTimeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div id="admin-applications-management" class="admin-tab">
                        <h3>Applications Management</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Application ID</th>
                                    <th>User</th>
                                    <th>Service Type</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminApplicationsTable">
                                <!-- Applications will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="admin-complaints-management" class="admin-tab">
                        <h3>Complaints Management</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Complaint ID</th>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Title</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminComplaintsTable">
                                <!-- Complaints will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="admin-user-management" class="admin-tab">
                        <h3>User Management</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Applications</th>
                                    <th>Complaints</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <!-- Users will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="admin-reports" class="admin-tab">
                        <h3>Reports & Analytics</h3>
                        <div class="chart-row">
                            <div class="chart-container">
                                <h4 class="chart-title">User Registration Trends</h4>
                                <div class="chart-wrapper">
                                    <canvas id="userRegistrationChart"></canvas>
                                </div>
                            </div>
                            <div class="chart-container">
                                <h4 class="chart-title">Processing Time Analysis</h4>
                                <div class="chart-wrapper">
                                    <canvas id="processingTimeChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 class="chart-title">Service Performance Metrics</h4>
                            <div class="chart-wrapper">
                                <canvas id="servicePerformanceChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-container">
                            <h4 class="chart-title">Complaint Resolution Time</h4>
                            <div class="chart-wrapper">
                                <canvas id="complaintResolutionChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div id="admin-settings" class="admin-tab">
                        <h3>Settings</h3>
                        <div class="application-form">
                            <div class="form-group">
                                <label for="systemName">System Name</label>
                                <input type="text" id="systemName" value="Municipality Services Portal">
                            </div>
                            <div class="form-group">
                                <label for="adminEmail">Admin Email</label>
                                <input type="email" id="adminEmail" value="admin@municipality.gov">
                            </div>
                            <div class="form-group">
                                <label for="notificationSettings">Notification Settings</label>
                                <select id="notificationSettings">
                                    <option value="all">All Notifications</option>
                                    <option value="important">Important Only</option>
                                    <option value="none">No Notifications</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="autoApproval">Auto-Approval Threshold</label>
                                <input type="number" id="autoApproval" value="7" min="1" max="30">
                                <small>Days after which applications are auto-approved if no action taken</small>
                            </div>
                            <button class="btn btn-primary">Save Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chatbot -->
        <div class="chatbot-container">
            <div class="chatbot-toggle" id="chatbotToggle">
                <i class="fas fa-comments"></i>
            </div>
            <div class="chatbot-window" id="chatbotWindow">
                <div class="chatbot-header">
                    <h3>Municipality Assistant</h3>
                    <button id="closeChatbot"><i class="fas fa-times"></i></button>
                </div>
                <div class="chatbot-messages" id="chatbotMessages">
                    <div class="message bot-message">
                        Hello! I'm your municipality assistant. How can I help you today?
                    </div>
                </div>
                <div class="chatbot-input">
                    <input type="text" id="chatbotInput" placeholder="Type your message...">
                    <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </div>

        <!-- Application Details Modal -->
        <div class="modal" id="applicationModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">Application Details</h3>
                    <button class="close-modal" id="closeModal">&times;</button>
                </div>
                <div id="modalContent">
                    <!-- Modal content will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Complaint Details Modal -->
        <div class="modal" id="complaintModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="complaintModalTitle">Complaint Details</h3>
                    <button class="close-modal" id="closeComplaintModal">&times;</button>
                </div>
                <div id="complaintModalContent">
                    <!-- Complaint modal content will be dynamically loaded here -->
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="login-modal" id="loginModal">
            <div class="login-form">
                <h2>User Login</h2>
                <form id="userLoginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                </form>
                <button class="btn admin-login-btn" id="adminLoginBtn" style="width: 100%; margin-top: 10px;">Admin Login</button>
                <button class="btn btn-secondary" id="closeLoginModal" style="width: 100%; margin-top: 10px;">Cancel</button>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div class="login-modal" id="adminLoginModal">
            <div class="login-form">
                <h2>Admin Login</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminUsername">Username</label>
                        <input type="text" id="adminUsername" placeholder="Enter admin username" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter admin password" required>
                    </div>
                    <button type="submit" class="btn btn-warning" style="width: 100%;">Login as Admin</button>
                </form>
                <button class="btn btn-secondary" id="closeAdminLoginModal" style="width: 100%; margin-top: 10px;">Cancel</button>
            </div>
        </div>

        <footer>
            <p>&copy; 2023 Municipality Services Portal. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // Sample data for the application
        let applications = JSON.parse(localStorage.getItem('applications')) || [];
        let complaints = JSON.parse(localStorage.getItem('complaints')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [
            { id: 1, name: "John Doe", email: "john@example.com", phone: "1234567890", status: "active", applications: 2, complaints: 1, registrationDate: "2023-01-15" },
            { id: 2, name: "Jane Smith", email: "jane@example.com", phone: "0987654321", status: "active", applications: 1, complaints: 0, registrationDate: "2023-02-20" },
            { id: 3, name: "Robert Johnson", email: "robert@example.com", phone: "1122334455", status: "active", applications: 3, complaints: 2, registrationDate: "2023-03-10" },
            { id: 4, name: "Emily Davis", email: "emily@example.com", phone: "5566778899", status: "inactive", applications: 0, complaints: 1, registrationDate: "2023-04-05" }
        ];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let isAdmin = JSON.parse(localStorage.getItem('isAdmin')) || false;
        let applicationIdCounter = parseInt(localStorage.getItem('applicationIdCounter')) || 1001;
        let complaintIdCounter = parseInt(localStorage.getItem('complaintIdCounter')) || 2001;
        let userIdCounter = parseInt(localStorage.getItem('userIdCounter')) || 5;

        // Admin credentials
        const adminCredentials = {
            username: "admin",
            password: "admin123"
        };

        // Complaint types and categories
        const complaintCategories = {
            sanitation: {
                title: "Sanitation Issues",
                icon: "fas fa-trash",
                description: "Garbage collection problems, overflowing bins, or unclean public areas"
            },
            roads: {
                title: "Road & Infrastructure",
                icon: "fas fa-road",
                description: "Potholes, damaged roads, street light issues, or traffic problems"
            },
            water: {
                title: "Water Supply",
                icon: "fas fa-tint",
                description: "Water supply issues, leakages, or water quality problems"
            },
            electricity: {
                title: "Electricity Issues",
                icon: "fas fa-bolt",
                description: "Power outages, electrical hazards, or street light malfunctions"
            },
            parks: {
                title: "Parks & Public Spaces",
                icon: "fas fa-tree",
                description: "Issues with public parks, playgrounds, or recreational facilities"
            },
            noise: {
                title: "Noise Pollution",
                icon: "fas fa-volume-up",
                description: "Excessive noise from construction, events, or commercial establishments"
            }
        };

        // Service-specific documentation requirements - EXTENDED WITH NEW SERVICES
        const documentationRequirements = {
            license: {
                title: "License Application Documentation",
                requirements: [
                    "Completed application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Passport-sized photographs (2 copies)",
                    "Educational qualification certificates (if applicable)",
                    "Experience certificates (if applicable)",
                    "No objection certificate from property owner (if applicable)",
                    "Payment receipt of application fee"
                ]
            },
            "license-renewal": {
                title: "License Renewal Documentation",
                requirements: [
                    "Completed renewal application form",
                    "Original license certificate",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Passport-sized photographs (2 copies)",
                    "Payment receipt of renewal fee"
                ]
            },
            "property-tax": {
                title: "Property Tax Documentation",
                requirements: [
                    "Property tax payment form",
                    "Property ownership documents",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Previous tax payment receipts (if any)",
                    "Property measurement details",
                    "Building plan approval (if applicable)"
                ]
            },
            "vehicle-registration": {
                title: "Vehicle Registration Documentation",
                requirements: [
                    "Vehicle registration application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Vehicle purchase invoice",
                    "Vehicle insurance certificate",
                    "Pollution under control certificate",
                    "Road tax payment receipt",
                    "Vehicle fitness certificate (for commercial vehicles)"
                ]
            },
            "trade-license": {
                title: "Trade License Documentation",
                requirements: [
                    "Trade license application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Business address proof",
                    "Partnership deed (if applicable)",
                    "Company incorporation certificate (if applicable)",
                    "No objection certificate from property owner",
                    "Site plan of business premises"
                ]
            },
            "building-permit": {
                title: "Building Permit Documentation",
                requirements: [
                    "Building permit application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Land ownership documents",
                    "Site plan and building drawings",
                    "Structural stability certificate",
                    "No objection certificate from neighbors (if required)",
                    "Environmental clearance (if applicable)"
                ]
            },
            "birth-certificate": {
                title: "Birth Certificate Documentation",
                requirements: [
                    "Birth certificate application form",
                    "Proof of identity of parents (Aadhar Card, Passport, etc.)",
                    "Proof of address of parents (Aadhar Card, Utility Bill, etc.)",
                    "Hospital birth record or delivery slip",
                    "Marriage certificate of parents",
                    "Affidavit for delayed registration (if applicable)"
                ]
            },
            "death-certificate": {
                title: "Death Certificate Documentation",
                requirements: [
                    "Death certificate application form",
                    "Proof of identity of applicant (Aadhar Card, Passport, etc.)",
                    "Proof of address of applicant (Aadhar Card, Utility Bill, etc.)",
                    "Hospital death record or medical certificate",
                    "Proof of identity of deceased (Aadhar Card, Passport, etc.)",
                    "Affidavit for delayed registration (if applicable)"
                ]
            },
            // NEW SERVICES DOCUMENTATION
            "water-connection": {
                title: "Water Connection Documentation",
                requirements: [
                    "Water connection application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Property ownership documents",
                    "Building plan approval",
                    "No objection certificate from property owner (if tenant)",
                    "Previous water bill (for transfer cases)"
                ]
            },
            "electricity-connection": {
                title: "Electricity Connection Documentation",
                requirements: [
                    "Electricity connection application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Property ownership documents",
                    "Building completion certificate",
                    "Load calculation details",
                    "No objection certificate from property owner (if tenant)"
                ]
            },
            "marriage-certificate": {
                title: "Marriage Certificate Documentation",
                requirements: [
                    "Marriage certificate application form",
                    "Proof of identity of both spouses (Aadhar Card, Passport, etc.)",
                    "Proof of address of both spouses (Aadhar Card, Utility Bill, etc.)",
                    "Date of birth proof of both spouses",
                    "Wedding invitation card or marriage photo",
                    "Affidavit of marriage",
                    "Witness details and identity proof"
                ]
            },
            "pet-license": {
                title: "Pet License Documentation",
                requirements: [
                    "Pet license application form",
                    "Proof of identity of owner (Aadhar Card, Passport, etc.)",
                    "Proof of address of owner (Aadhar Card, Utility Bill, etc.)",
                    "Pet vaccination records",
                    "Pet photograph",
                    "Veterinary health certificate",
                    "Proof of sterilization (if applicable)"
                ]
            },
            "event-permit": {
                title: "Event Permit Documentation",
                requirements: [
                    "Event permit application form",
                    "Proof of identity of organizer (Aadhar Card, Passport, etc.)",
                    "Event details and schedule",
                    "Venue permission letter",
                    "Noise pollution control plan",
                    "Traffic management plan (if applicable)",
                    "Security arrangements details",
                    "Fire safety compliance certificate"
                ]
            },
            "encumbrance-certificate": {
                title: "Encumbrance Certificate Documentation",
                requirements: [
                    "Encumbrance certificate application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Property details and survey number",
                    "Property tax receipts",
                    "Previous ownership documents",
                    "Purpose of certificate request"
                ]
            },
            "pension": {
                title: "Pension Services Documentation",
                requirements: [
                    "Pension application form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of age/date of birth",
                    "Service certificate from employer",
                    "Bank account details",
                    "Passport-sized photographs",
                    "Medical certificate (if applicable)",
                    "Nomination details"
                ]
            },
            "public-health": {
                title: "Public Health Services Documentation",
                requirements: [
                    "Health service request form",
                    "Proof of identity (Aadhar Card, Passport, etc.)",
                    "Proof of address (Aadhar Card, Utility Bill, etc.)",
                    "Medical reports (if applicable)",
                    "Health insurance details (if applicable)",
                    "Referral letter from doctor (if applicable)"
                ]
            }
        };

        // Service-specific forms - EXTENDED WITH NEW SERVICES
        const serviceForms = {
            // Existing forms remain the same
            license: `
                <h2 class="section-title">License Application</h2>
                <form id="licenseForm" class="application-form">
                    <div class="form-group">
                        <label for="licenseType">License Type</label>
                        <select id="licenseType" required>
                            <option value="">Select License Type</option>
                            <option value="business">Business License</option>
                            <option value="professional">Professional License</option>
                            <option value="trade">Trade License</option>
                            <option value="vehicle">Vehicle License</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Address</label>
                        <textarea id="address" placeholder="Enter your complete address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email address" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="aadharFrontUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Aadhar Card (Front)</p>
                            <input type="file" id="aadharFront" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="aadharBackUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Aadhar Card (Back)</p>
                            <input type="file" id="aadharBack" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="photoUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Passport Photo</p>
                            <input type="file" id="photo" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            // ... (all existing forms remain the same)
            
            // NEW SERVICE FORMS
            "water-connection": `
                <h2 class="section-title">Water Connection Application</h2>
                <form id="waterConnectionForm" class="application-form">
                    <div class="form-group">
                        <label for="connectionType">Connection Type</label>
                        <select id="connectionType" required>
                            <option value="">Select Connection Type</option>
                            <option value="new">New Connection</option>
                            <option value="transfer">Transfer Connection</option>
                            <option value="modification">Modification</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="propertyType">Property Type</label>
                        <select id="propertyType" required>
                            <option value="">Select Property Type</option>
                            <option value="residential">Residential</option>
                            <option value="commercial">Commercial</option>
                            <option value="industrial">Industrial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="applicantName">Applicant Name</label>
                        <input type="text" id="applicantName" placeholder="Enter applicant name" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyAddress">Property Address</label>
                        <textarea id="propertyAddress" placeholder="Enter property address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email address" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="idProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload ID Proof</p>
                            <input type="file" id="idProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="addressProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Address Proof</p>
                            <input type="file" id="addressProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="propertyDocUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Property Documents</p>
                            <input type="file" id="propertyDoc" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            "electricity-connection": `
                <h2 class="section-title">Electricity Connection Application</h2>
                <form id="electricityConnectionForm" class="application-form">
                    <div class="form-group">
                        <label for="connectionType">Connection Type</label>
                        <select id="connectionType" required>
                            <option value="">Select Connection Type</option>
                            <option value="domestic">Domestic</option>
                            <option value="commercial">Commercial</option>
                            <option value="industrial">Industrial</option>
                            <option value="agricultural">Agricultural</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="loadRequired">Load Required (in kW)</label>
                        <input type="number" id="loadRequired" placeholder="Enter required load" required>
                    </div>
                    <div class="form-group">
                        <label for="applicantName">Applicant Name</label>
                        <input type="text" id="applicantName" placeholder="Enter applicant name" required>
                    </div>
                    <div class="form-group">
                        <label for="propertyAddress">Property Address</label>
                        <textarea id="propertyAddress" placeholder="Enter property address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="Enter your phone number" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="Enter your email address" required>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="idProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload ID Proof</p>
                            <input type="file" id="idProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="addressProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Address Proof</p>
                            <input type="file" id="addressProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="propertyDocUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Property Documents</p>
                            <input type="file" id="propertyDoc" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            "marriage-certificate": `
                <h2 class="section-title">Marriage Certificate Application</h2>
                <form id="marriageCertificateForm" class="application-form">
                    <div class="form-group">
                        <label for="groomName">Groom's Full Name</label>
                        <input type="text" id="groomName" placeholder="Enter groom's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="brideName">Bride's Full Name</label>
                        <input type="text" id="brideName" placeholder="Enter bride's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="marriageDate">Marriage Date</label>
                        <input type="date" id="marriageDate" required>
                    </div>
                    <div class="form-group">
                        <label for="marriagePlace">Place of Marriage</label>
                        <input type="text" id="marriagePlace" placeholder="Enter place of marriage" required>
                    </div>
                    <div class="form-group">
                        <label for="groomAddress">Groom's Address</label>
                        <textarea id="groomAddress" placeholder="Enter groom's address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="brideAddress">Bride's Address</label>
                        <textarea id="brideAddress" placeholder="Enter bride's address" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Upload Required Documents</label>
                        <div class="file-upload-container" id="groomIdUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Groom's ID Proof</p>
                            <input type="file" id="groomId" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="brideIdUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Bride's ID Proof</p>
                            <input type="file" id="brideId" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-upload-container" id="marriageProofUpload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload Marriage Proof</p>
                            <input type="file" id="marriageProof" accept="image/*" style="display: none;">
                        </div>
                        <div class="file-preview" id="filePreview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            `,
            // Additional forms for other new services would follow the same pattern
            // ... (other new service forms)
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    const sectionId = this.getAttribute('data-section');
                    document.getElementById(sectionId).classList.add('active');
                });
            });

            // Service category cards
            document.querySelectorAll('.category-card[data-service]').forEach(card => {
                card.addEventListener('click', function() {
                    const service = this.getAttribute('data-service');
                    
                    // Switch to service forms section
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    document.querySelector('[data-section="services"]').classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById('service-forms').classList.add('active');
                    
                    // Load the appropriate form
                    loadServiceForm(service);
                });
            });

            // Documentation "Apply Now" buttons
            document.querySelectorAll('.apply-now-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent triggering the parent card click
                    const service = this.getAttribute('data-service');
                    
                    // Switch to service forms section
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    document.querySelector('[data-section="services"]').classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById('service-forms').classList.add('active');
                    
                    // Load the appropriate form
                    loadServiceForm(service);
                });
            });

            // Complaint category cards
            document.querySelectorAll('.complaint-category').forEach(card => {
                card.addEventListener('click', function() {
                    const complaintType = this.getAttribute('data-complaint-type');
                    loadComplaintForm(complaintType);
                });
            });

            // Documentation category cards
            document.querySelectorAll('.category-card[data-doc]').forEach(card => {
                card.addEventListener('click', function() {
                    const docType = this.getAttribute('data-doc');
                    
                    // Switch to documentation details section
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    document.querySelector('[data-section="documentation"]').classList.add('active');
                    
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById('documentation-details').classList.add('active');
                    
                    // Load the appropriate documentation
                    loadDocumentationDetails(docType);
                });
            });

            // Admin navigation
            document.querySelectorAll('.admin-nav').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.admin-nav').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.admin-tab').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`admin-${tabId}`).classList.add('active');
                });
            });

            // File upload functionality
            function setupFileUpload(uploadContainerId, fileInputId) {
                const uploadContainer = document.getElementById(uploadContainerId);
                const fileInput = document.getElementById(fileInputId);
                
                if (uploadContainer && fileInput) {
                    uploadContainer.addEventListener('click', function() {
                        fileInput.click();
                    });
                    
                    fileInput.addEventListener('change', function() {
                        if (this.files && this.files[0]) {
                            const previewContainer = document.getElementById('filePreview') || document.getElementById('complaintFilePreview');
                            for (let i = 0; i < this.files.length; i++) {
                                const file = this.files[i];
                                const reader = new FileReader();
                                
                                reader.onload = function(e) {
                                    const previewItem = document.createElement('div');
                                    previewItem.className = 'file-preview-item';
                                    
                                    const img = document.createElement('img');
                                    img.src = e.target.result;
                                    
                                    const removeBtn = document.createElement('button');
                                    removeBtn.className = 'remove-file';
                                    removeBtn.innerHTML = '&times;';
                                    removeBtn.addEventListener('click', function() {
                                        previewItem.remove();
                                    });
                                    
                                    previewItem.appendChild(img);
                                    previewItem.appendChild(removeBtn);
                                    previewContainer.appendChild(previewItem);
                                };
                                
                                reader.readAsDataURL(file);
                            }
                        }
                    });
                }
            }

            // Load service form
            function loadServiceForm(service) {
                const formsSection = document.getElementById('service-forms');
                formsSection.innerHTML = serviceForms[service] || '<p>Form not available for this service.</p>';
                
                // Set up file uploads for the loaded form
                // This will set up all file upload containers in the form
                const fileUploadContainers = formsSection.querySelectorAll('.file-upload-container');
                fileUploadContainers.forEach(container => {
                    const fileInputId = container.querySelector('input[type="file"]').id;
                    setupFileUpload(container.id, fileInputId);
                });
                
                // Set up form submission
                const form = document.getElementById(service + 'Form');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        submitApplication(service, this);
                    });
                }
            }

            // Load complaint form
            function loadComplaintForm(complaintType) {
                const complaintFormContainer = document.getElementById('complaintFormContainer');
                const complaintFormTitle = document.getElementById('complaintFormTitle');
                
                complaintFormTitle.textContent = `File ${complaintCategories[complaintType].title} Complaint`;
                complaintFormContainer.style.display = 'block';
                
                // Set up file upload for complaint photos
                setupFileUpload('complaintPhotoUpload', 'complaintPhoto');
                
                // Set up form submission
                const complaintForm = document.getElementById('complaintForm');
                complaintForm.onsubmit = function(e) {
                    e.preventDefault();
                    submitComplaint(complaintType, this);
                };
                
                // Scroll to form
                complaintFormContainer.scrollIntoView({ behavior: 'smooth' });
            }

            // Load documentation details
            function loadDocumentationDetails(docType) {
                const detailsSection = document.getElementById('documentation-details');
                const doc = documentationRequirements[docType];
                
                if (doc) {
                    let html = `<h2 class="section-title">${doc.title}</h2>`;
                    html += '<div class="documentation-info">';
                    html += '<h3>Required Documents:</h3>';
                    html += '<ul>';
                    
                    doc.requirements.forEach(req => {
                        html += `<li>${req}</li>`;
                    });
                    
                    html += '</ul>';
                    html += '</div>';
                    html += `<button class="btn btn-primary" onclick="applyForService('${docType}')">Apply Now</button>`;
                    
                    detailsSection.innerHTML = html;
                } else {
                    detailsSection.innerHTML = '<p>Documentation details not available for this service.</p>';
                }
            }

            // Apply for service from documentation
            window.applyForService = function(service) {
                // Switch to service forms section
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelector('[data-section="services"]').classList.add('active');
                
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                document.getElementById('service-forms').classList.add('active');
                
                // Load the appropriate form
                loadServiceForm(service);
            };

            // Submit application
            function submitApplication(serviceType, form) {
                if (!currentUser) {
                    alert('Please login to submit an application.');
                    return;
                }
                
                const formData = new FormData(form);
                const applicationData = {};
                
                for (let [key, value] of formData.entries()) {
                    applicationData[key] = value;
                }
                
                const application = {
                    id: applicationIdCounter++,
                    userId: currentUser.id,
                    serviceType: serviceType,
                    data: applicationData,
                    status: 'pending',
                    date: new Date().toISOString().split('T')[0],
                    userName: currentUser.name,
                    userEmail: currentUser.email,
                    userPhone: currentUser.phone
                };
                
                applications.push(application);
                saveData();
                
                // Update user application count
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].applications = (users[userIndex].applications || 0) + 1;
                }
                
                alert(`Application submitted successfully! Your application ID is: ${application.id}`);
                form.reset();
                
                // Clear file previews
                const filePreview = document.getElementById('filePreview');
                if (filePreview) {
                    filePreview.innerHTML = '';
                }
                
                // Update application lists
                updateApplicationList();
                updateAdminApplicationsTable();
                updateStats();
            }

            // Submit complaint
            function submitComplaint(complaintType, form) {
                if (!currentUser) {
                    alert('Please login to submit a complaint.');
                    return;
                }
                
                const formData = new FormData(form);
                const complaintData = {};
                
                for (let [key, value] of formData.entries()) {
                    complaintData[key] = value;
                }
                
                const complaint = {
                    id: complaintIdCounter++,
                    userId: currentUser.id,
                    type: complaintType,
                    title: complaintData.complaintTitle,
                    description: complaintData.complaintDescription,
                    location: complaintData.complaintLocation,
                    priority: complaintData.complaintPriority,
                    status: 'open',
                    date: new Date().toISOString().split('T')[0],
                    userName: currentUser.name,
                    userEmail: currentUser.email,
                    userPhone: currentUser.phone,
                    adminNotes: '',
                    resolutionDate: null
                };
                
                complaints.push(complaint);
                saveData();
                
                // Update user complaint count
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].complaints = (users[userIndex].complaints || 0) + 1;
                }
                
                alert(`Complaint submitted successfully! Your complaint ID is: ${complaint.id}`);
                form.reset();
                
                // Clear file previews
                const complaintFilePreview = document.getElementById('complaintFilePreview');
                if (complaintFilePreview) {
                    complaintFilePreview.innerHTML = '';
                }
                
                // Update complaint lists
                updateComplaintList();
                updateAdminComplaintsTable();
                updateStats();
            }

            // Enhanced chatbot functionality
            document.getElementById('chatbotToggle').addEventListener('click', function() {
                document.getElementById('chatbotWindow').style.display = 'flex';
            });

            document.getElementById('closeChatbot').addEventListener('click', function() {
                document.getElementById('chatbotWindow').style.display = 'none';
            });

            document.getElementById('sendMessage').addEventListener('click', sendMessage);
            document.getElementById('chatbotInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            function sendMessage() {
                const input = document.getElementById('chatbotInput');
                const message = input.value.trim();
                
                if (message) {
                    // Add user message
                    addMessage(message, 'user');
                    input.value = '';
                    
                    // Generate bot response
                    setTimeout(() => {
                        const response = generateBotResponse(message);
                        addMessage(response.text, 'bot');
                        
                        // Add details if available
                        if (response.details) {
                            const detailsElement = document.createElement('div');
                            detailsElement.className = 'message bot-message';
                            detailsElement.innerHTML = response.details;
                            
                            // Add apply button if action is specified
                            if (response.action) {
                                const applyButton = document.createElement('button');
                                applyButton.className = 'apply-now-btn';
                                applyButton.textContent = 'Apply Now';
                                applyButton.onclick = function() {
                                    applyForService(response.action);
                                    document.getElementById('chatbotWindow').style.display = 'none';
                                };
                                detailsElement.appendChild(applyButton);
                            }
                            
                            document.getElementById('chatbotMessages').appendChild(detailsElement);
                        }
                        
                        // Add quick actions if available
                        if (response.quickActions) {
                            const quickActionsContainer = document.createElement('div');
                            quickActionsContainer.className = 'chatbot-quick-actions';
                            
                            response.quickActions.forEach(action => {
                                const actionButton = document.createElement('button');
                                actionButton.className = 'quick-action-btn';
                                actionButton.textContent = action;
                                actionButton.onclick = function() {
                                    document.getElementById('chatbotInput').value = action;
                                    sendMessage();
                                };
                                quickActionsContainer.appendChild(actionButton);
                            });
                            
                            document.getElementById('chatbotMessages').appendChild(quickActionsContainer);
                        }
                        
                        document.getElementById('chatbotMessages').scrollTop = document.getElementById('chatbotMessages').scrollHeight;
                    }, 500);
                }
            }

            function addMessage(text, sender) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageElement = document.createElement('div');
                messageElement.classList.add('message', `${sender}-message`);
                messageElement.textContent = text;
                messagesContainer.appendChild(messageElement);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }

            function generateBotResponse(message) {
                const lowerMessage = message.toLowerCase();
                
                // Greeting responses
                if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                    return {
                        text: "Hello! I'm your municipality assistant. I can help you with:",
                        quickActions: [
                            "License Application",
                            "Property Tax Payment", 
                            "Vehicle Registration",
                            "Trade License",
                            "Building Permit",
                            "Birth Certificate",
                            "Death Certificate",
                            "Water Connection",
                            "Electricity Connection",
                            "Marriage Certificate",
                            "Pet License",
                            "Event Permit",
                            "Encumbrance Certificate",
                            "Pension Services",
                            "Public Health Services",
                            "Document Requirements",
                            "File a Complaint"
                        ]
                    };
                }
                
                // License application information
                if (lowerMessage.includes('license') && lowerMessage.includes('apply')) {
                    return {
                        text: "For License Application, here's what you need to know:",
                        details: `
                            <div class="service-steps">
                                <h4>License Application Process:</h4>
                                <ol>
                                    <li>Fill out the license application form with personal details</li>
                                    <li>Select the type of license (Business, Professional, Trade, Vehicle)</li>
                                    <li>Upload required documents including Aadhar card front and back</li>
                                    <li>Submit the application for processing</li>
                                    <li>Track application status in 'My Applications' section</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of Identity (Aadhar Card, Passport, etc.)</li>
                                    <li>Proof of Address (Aadhar Card, Utility Bill, etc.)</li>
                                    <li>Passport-sized Photographs (2 copies)</li>
                                    <li>Educational qualification certificates (if applicable)</li>
                                    <li>Experience certificates (if applicable)</li>
                                    <li>No objection certificate from property owner (if applicable)</li>
                                </ul>
                            </div>
                        `,
                        action: "license"
                    };
                }
                
                // Water connection information
                if (lowerMessage.includes('water') && (lowerMessage.includes('connection') || lowerMessage.includes('supply'))) {
                    return {
                        text: "For Water Connection, here's the process:",
                        details: `
                            <div class="service-steps">
                                <h4>Water Connection Process:</h4>
                                <ol>
                                    <li>Select connection type (New, Transfer, Modification)</li>
                                    <li>Specify property type (Residential, Commercial, Industrial)</li>
                                    <li>Provide applicant details and property address</li>
                                    <li>Upload required documents including ID and property proof</li>
                                    <li>Submit application for processing</li>
                                    <li>Pay connection charges if applicable</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of Identity (Aadhar Card, Passport, etc.)</li>
                                    <li>Proof of Address (Aadhar Card, Utility Bill, etc.)</li>
                                    <li>Property ownership documents</li>
                                    <li>Building plan approval</li>
                                    <li>No objection certificate from property owner (if tenant)</li>
                                    <li>Previous water bill (for transfer cases)</li>
                                </ul>
                            </div>
                        `,
                        action: "water-connection"
                    };
                }
                
                // Electricity connection information
                if (lowerMessage.includes('electricity') && lowerMessage.includes('connection')) {
                    return {
                        text: "For Electricity Connection, here's what you need:",
                        details: `
                            <div class="service-steps">
                                <h4>Electricity Connection Process:</h4>
                                <ol>
                                    <li>Select connection type (Domestic, Commercial, Industrial, Agricultural)</li>
                                    <li>Specify required load in kW</li>
                                    <li>Provide applicant details and property address</li>
                                    <li>Upload required documents including ID and property proof</li>
                                    <li>Submit application for processing</li>
                                    <li>Pay connection charges and security deposit</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of Identity (Aadhar Card, Passport, etc.)</li>
                                    <li>Proof of Address (Aadhar Card, Utility Bill, etc.)</li>
                                    <li>Property ownership documents</li>
                                    <li>Building completion certificate</li>
                                    <li>Load calculation details</li>
                                    <li>No objection certificate from property owner (if tenant)</li>
                                </ul>
                            </div>
                        `,
                        action: "electricity-connection"
                    };
                }
                
                // Marriage certificate information
                if (lowerMessage.includes('marriage') || lowerMessage.includes('wedding')) {
                    return {
                        text: "For Marriage Certificate Registration, here's the procedure:",
                        details: `
                            <div class="service-steps">
                                <h4>Marriage Certificate Process:</h4>
                                <ol>
                                    <li>Provide groom and bride details</li>
                                    <li>Enter marriage date and place</li>
                                    <li>Provide addresses of both spouses</li>
                                    <li>Upload required documents including ID proofs and marriage proof</li>
                                    <li>Submit application for registration</li>
                                    <li>Collect certificate after verification</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of identity of both spouses</li>
                                    <li>Proof of address of both spouses</li>
                                    <li>Date of birth proof of both spouses</li>
                                    <li>Wedding invitation card or marriage photo</li>
                                    <li>Affidavit of marriage</li>
                                    <li>Witness details and identity proof</li>
                                </ul>
                            </div>
                        `,
                        action: "marriage-certificate"
                    };
                }
                
                // Pet license information
                if (lowerMessage.includes('pet') || lowerMessage.includes('dog') || lowerMessage.includes('cat')) {
                    return {
                        text: "For Pet License Registration, here's what you need:",
                        details: `
                            <div class="service-steps">
                                <h4>Pet License Process:</h4>
                                <ol>
                                    <li>Fill out pet license application form</li>
                                    <li>Provide owner details and pet information</li>
                                    <li>Upload required documents including vaccination records</li>
                                    <li>Submit application for processing</li>
                                    <li>Pay license fee</li>
                                    <li>Receive pet license tag</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of identity of owner</li>
                                    <li>Proof of address of owner</li>
                                    <li>Pet vaccination records</li>
                                    <li>Pet photograph</li>
                                    <li>Veterinary health certificate</li>
                                    <li>Proof of sterilization (if applicable)</li>
                                </ul>
                            </div>
                        `,
                        action: "pet-license"
                    };
                }
                
                // Event permit information
                if (lowerMessage.includes('event') || lowerMessage.includes('permit') || lowerMessage.includes('gathering')) {
                    return {
                        text: "For Event Permit Application, here's the process:",
                        details: `
                            <div class="service-steps">
                                <h4>Event Permit Process:</h4>
                                <ol>
                                    <li>Fill out event permit application form</li>
                                    <li>Provide event details and schedule</li>
                                    <li>Specify venue and expected attendance</li>
                                    <li>Upload required documents including venue permission</li>
                                    <li>Submit application for approval</li>
                                    <li>Pay permit fee if applicable</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of identity of organizer</li>
                                    <li>Event details and schedule</li>
                                    <li>Venue permission letter</li>
                                    <li>Noise pollution control plan</li>
                                    <li>Traffic management plan (if applicable)</li>
                                    <li>Security arrangements details</li>
                                    <li>Fire safety compliance certificate</li>
                                </ul>
                            </div>
                        `,
                        action: "event-permit"
                    };
                }
                
                // Encumbrance certificate information
                if (lowerMessage.includes('encumbrance') || lowerMessage.includes('property certificate')) {
                    return {
                        text: "For Encumbrance Certificate, here's what you need:",
                        details: `
                            <div class="service-steps">
                                <h4>Encumbrance Certificate Process:</h4>
                                <ol>
                                    <li>Fill out encumbrance certificate application form</li>
                                    <li>Provide property details and survey number</li>
                                    <li>Specify period for which certificate is required</li>
                                    <li>Upload required documents including property details</li>
                                    <li>Submit application for processing</li>
                                    <li>Pay applicable fees</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of identity</li>
                                    <li>Proof of address</li>
                                    <li>Property details and survey number</li>
                                    <li>Property tax receipts</li>
                                    <li>Previous ownership documents</li>
                                    <li>Purpose of certificate request</li>
                                </ul>
                            </div>
                        `,
                        action: "encumbrance-certificate"
                    };
                }
                
                // Pension services information
                if (lowerMessage.includes('pension') || lowerMessage.includes('retirement')) {
                    return {
                        text: "For Pension Services, here's the application process:",
                        details: `
                            <div class="service-steps">
                                <h4>Pension Application Process:</h4>
                                <ol>
                                    <li>Fill out pension application form</li>
                                    <li>Provide personal and employment details</li>
                                    <li>Specify type of pension and eligibility</li>
                                    <li>Upload required documents including service certificate</li>
                                    <li>Submit application for processing</li>
                                    <li>Provide bank account details for disbursement</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of identity</li>
                                    <li>Proof of age/date of birth</li>
                                    <li>Service certificate from employer</li>
                                    <li>Bank account details</li>
                                    <li>Passport-sized photographs</li>
                                    <li>Medical certificate (if applicable)</li>
                                    <li>Nomination details</li>
                                </ul>
                            </div>
                        `,
                        action: "pension"
                    };
                }
                
                // Public health services information
                if (lowerMessage.includes('health') || lowerMessage.includes('medical') || lowerMessage.includes('hospital')) {
                    return {
                        text: "For Public Health Services, here's how to access them:",
                        details: `
                            <div class="service-steps">
                                <h4>Public Health Services Process:</h4>
                                <ol>
                                    <li>Fill out health service request form</li>
                                    <li>Specify type of health service required</li>
                                    <li>Provide personal and health details</li>
                                    <li>Upload required documents if applicable</li>
                                    <li>Submit request for processing</li>
                                    <li>Receive service details and appointment if needed</li>
                                </ol>
                            </div>
                            <div class="document-list">
                                <h4>Required Documents:</h4>
                                <ul>
                                    <li>Proof of identity</li>
                                    <li>Proof of address</li>
                                    <li>Medical reports (if applicable)</li>
                                    <li>Health insurance details (if applicable)</li>
                                    <li>Referral letter from doctor (if applicable)</li>
                                </ul>
                            </div>
                        `,
                        action: "public-health"
                    };
                }
                
                // Default response
                return {
                    text: "I'm here to help with municipality services. You can ask me about:",
                    details: `
                        <div class="service-steps">
                            <ul>
                                <li>License applications and renewals</li>
                                <li>Property tax payment process</li>
                                <li>Vehicle registration requirements</li>
                                <li>Trade license documentation</li>
                                <li>Building permit procedures</li>
                                <li>Birth and death certificate applications</li>
                                <li>Water and electricity connections</li>
                                <li>Marriage certificate registration</li>
                                <li>Pet licensing</li>
                                <li>Event permits</li>
                                <li>Encumbrance certificates</li>
                                <li>Pension services</li>
                                <li>Public health services</li>
                                <li>Filing complaints about municipal issues</li>
                                <li>Document upload requirements</li>
                                <li>Application and complaint tracking</li>
                            </ul>
                        </div>
                        <p>Or use the quick action buttons below for specific services!</p>
                    `,
                    quickActions: [
                        "License Application",
                        "Property Tax", 
                        "Vehicle Registration",
                        "Trade License",
                        "Building Permit",
                        "Birth Certificate",
                        "Death Certificate",
                        "Water Connection",
                        "Electricity Connection",
                        "Marriage Certificate",
                        "Pet License",
                        "Event Permit",
                        "Encumbrance Certificate",
                        "Pension Services",
                        "Public Health Services",
                        "File Complaint"
                    ]
                };
            }

            // Initialize chatbot with welcome message and quick actions
            function initializeChatbot() {
                const welcomeResponse = generateBotResponse('hello');
                addMessage(welcomeResponse.text, 'bot');
                
                if (welcomeResponse.quickActions) {
                    const quickActionsContainer = document.createElement('div');
                    quickActionsContainer.className = 'chatbot-quick-actions';
                    
                    welcomeResponse.quickActions.forEach(action => {
                        const actionButton = document.createElement('button');
                        actionButton.className = 'quick-action-btn';
                        actionButton.textContent = action;
                        actionButton.onclick = function() {
                            document.getElementById('chatbotInput').value = action;
                            sendMessage();
                        };
                        quickActionsContainer.appendChild(actionButton);
                    });
                    
                    document.getElementById('chatbotMessages').appendChild(quickActionsContainer);
                }
            }

            // Login/Register functionality
            document.getElementById('loginBtn').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'flex';
            });

            document.getElementById('closeLoginModal').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'none';
            });

            document.getElementById('adminLoginBtn').addEventListener('click', function() {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('adminLoginModal').style.display = 'flex';
            });

            document.getElementById('closeAdminLoginModal').addEventListener('click', function() {
                document.getElementById('adminLoginModal').style.display = 'none';
            });

            document.getElementById('userLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                // Simple authentication - in a real app, this would be more secure
                let user = users.find(u => u.email === email);
                if (user) {
                    currentUser = user;
                    isAdmin = false;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
                    document.getElementById('loginModal').style.display = 'none';
                    alert(`Welcome back, ${user.name}!`);
                    updateUIForUser();
                } else {
                    alert('User not found. Please register.');
                }
            });

            document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('adminUsername').value;
                const password = document.getElementById('adminPassword').value;
                
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    isAdmin = true;
                    localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
                    document.getElementById('adminLoginModal').style.display = 'none';
                    alert('Welcome, Admin!');
                    updateUIForUser();
                } else {
                    alert('Invalid admin credentials. Please try again.');
                }
            });

            document.getElementById('registerBtn').addEventListener('click', function() {
                const name = prompt('Enter your full name:');
                const email = prompt('Enter your email:');
                const phone = prompt('Enter your phone number:');
                
                if (name && email && phone) {
                    const newUser = {
                        id: userIdCounter++,
                        name: name,
                        email: email,
                        phone: phone,
                        status: 'active',
                        applications: 0,
                        complaints: 0
                    };
                    
                    users.push(newUser);
                    currentUser = newUser;
                    isAdmin = false;
                    saveData();
                    
                    alert(`Registration successful! Welcome, ${name}.`);
                    updateUIForUser();
                }
            });

            function updateUIForUser() {
                if (currentUser || isAdmin) {
                    document.getElementById('loginBtn').textContent = 'Logout';
                    document.getElementById('registerBtn').style.display = 'none';
                    
                    document.getElementById('loginBtn').onclick = function() {
                        currentUser = null;
                        isAdmin = false;
                        localStorage.removeItem('currentUser');
                        localStorage.removeItem('isAdmin');
                        alert('You have been logged out.');
                        location.reload();
                    };
                }
            }

            // Modal functionality
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('applicationModal').style.display = 'none';
            });

            document.getElementById('closeComplaintModal').addEventListener('click', function() {
                document.getElementById('complaintModal').style.display = 'none';
            });

            window.closeModal = function() {
                document.getElementById('applicationModal').style.display = 'none';
            };

            window.closeComplaintModal = function() {
                document.getElementById('complaintModal').style.display = 'none';
            };

            // Initialize UI
            updateApplicationList();
            updateComplaintList();
            updateAdminApplicationsTable();
            updateAdminComplaintsTable();
            updateAdminUsersTable();
            updateStats();
            init3DAnimation();
            updateUIForUser();
            initializeChatbot();

            // Set up periodic updates for demo purposes
            setInterval(updateStats, 5000);
        });

        // Data management functions
        function saveData() {
            localStorage.setItem('applications', JSON.stringify(applications));
            localStorage.setItem('complaints', JSON.stringify(complaints));
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('applicationIdCounter', applicationIdCounter.toString());
            localStorage.setItem('complaintIdCounter', complaintIdCounter.toString());
            localStorage.setItem('userIdCounter', userIdCounter.toString());
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            localStorage.setItem('isAdmin', JSON.stringify(isAdmin));
        }

        function updateApplicationList() {
            const applicationList = document.getElementById('applicationList');
            applicationList.innerHTML = '';
            
            let userApplications = applications;
            if (currentUser) {
                userApplications = applications.filter(a => a.userId === currentUser.id);
            }
            
            if (userApplications.length === 0) {
                applicationList.innerHTML = '<p>No applications found.</p>';
                return;
            }
            
            userApplications.forEach(application => {
                const applicationItem = document.createElement('div');
                applicationItem.className = 'application-item';
                
                const statusClass = `status-${application.status.replace(' ', '-')}`;
                
                applicationItem.innerHTML = `
                    <div class="application-info">
                        <h3>${getServiceDisplayName(application.serviceType)} (ID: ${application.id})</h3>
                        <p>Submitted on: ${application.date}</p>
                        <div class="application-meta">
                            <span><i class="fas fa-calendar"></i> ${application.date}</span>
                            <span><i class="fas fa-user"></i> ${application.userName}</span>
                        </div>
                    </div>
                    <div class="application-status">
                        <span class="status ${statusClass}">${application.status}</span>
                        <button class="btn btn-primary view-details" data-id="${application.id}" style="margin-top: 10px;">View Details</button>
                    </div>
                `;
                
                applicationList.appendChild(applicationItem);
            });
            
            // Add event listeners for view details buttons
            document.querySelectorAll('.view-details').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    viewApplicationDetails(id);
                });
            });
        }

        function updateComplaintList() {
            const complaintList = document.getElementById('complaintList');
            complaintList.innerHTML = '';
            
            let userComplaints = complaints;
            if (currentUser) {
                userComplaints = complaints.filter(c => c.userId === currentUser.id);
            }
            
            if (userComplaints.length === 0) {
                complaintList.innerHTML = '<p>No complaints found.</p>';
                return;
            }
            
            userComplaints.forEach(complaint => {
                const complaintItem = document.createElement('div');
                complaintItem.className = 'complaint-item';
                
                const statusClass = `status-${complaint.status}`;
                
                complaintItem.innerHTML = `
                    <div class="complaint-info">
                        <h3>${complaint.title} (ID: ${complaint.id})</h3>
                        <p>Type: ${complaintCategories[complaint.type].title}</p>
                        <div class="complaint-meta">
                            <span><i class="fas fa-calendar"></i> ${complaint.date}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${complaint.location}</span>
                            <span><i class="fas fa-exclamation-circle"></i> ${complaint.priority}</span>
                        </div>
                    </div>
                    <div class="complaint-status">
                        <span class="status ${statusClass}">${complaint.status}</span>
                        <button class="btn btn-primary view-complaint-details" data-id="${complaint.id}" style="margin-top: 10px;">View Details</button>
                    </div>
                `;
                
                complaintList.appendChild(complaintItem);
            });
            
            // Add event listeners for view details buttons
            document.querySelectorAll('.view-complaint-details').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    viewComplaintDetails(id);
                });
            });
        }

        function getServiceDisplayName(serviceType) {
            const displayNames = {
                'license': 'License Application',
                'license-renewal': 'License Renewal',
                'property-tax': 'Property Tax Payment',
                'vehicle-registration': 'Vehicle Registration',
                'trade-license': 'Trade License',
                'building-permit': 'Building Permit',
                'birth-certificate': 'Birth Certificate',
                'death-certificate': 'Death Certificate',
                'water-connection': 'Water Connection',
                'electricity-connection': 'Electricity Connection',
                'marriage-certificate': 'Marriage Certificate',
                'pet-license': 'Pet License',
                'event-permit': 'Event Permit',
                'encumbrance-certificate': 'Encumbrance Certificate',
                'pension': 'Pension Services',
                'public-health': 'Public Health Services'
            };
            
            return displayNames[serviceType] || serviceType;
        }

        function viewApplicationDetails(id) {
            const application = applications.find(a => a.id === id);
            if (application) {
                const modal = document.getElementById('applicationModal');
                const modalTitle = document.getElementById('modalTitle');
                const modalContent = document.getElementById('modalContent');
                
                modalTitle.textContent = `${getServiceDisplayName(application.serviceType)} - Application Details`;
                
                let html = `<p><strong>Application ID:</strong> ${application.id}</p>`;
                html += `<p><strong>Service Type:</strong> ${getServiceDisplayName(application.serviceType)}</p>`;
                html += `<p><strong>Submitted Date:</strong> ${application.date}</p>`;
                html += `<p><strong>Status:</strong> <span class="status status-${application.status.replace(' ', '-')}">${application.status}</span></p>`;
                
                html += '<h4>Application Details:</h4>';
                html += '<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">';
                
                for (const [key, value] of Object.entries(application.data)) {
                    if (key !== 'file') {
                        html += `<tr><td style="padding: 8px; border-bottom: 1px solid #eee;"><strong>${formatFieldName(key)}:</strong></td><td style="padding: 8px; border-bottom: 1px solid #eee;">${value}</td></tr>`;
                    }
                }
                
                html += '</table>';
                
                if (application.adminNotes) {
                    html += `<h4>Admin Notes:</h4><p>${application.adminNotes}</p>`;
                }
                
                modalContent.innerHTML = html;
                modal.style.display = 'flex';
            }
        }

        function viewComplaintDetails(id) {
            const complaint = complaints.find(c => c.id === id);
            if (complaint) {
                const modal = document.getElementById('complaintModal');
                const modalTitle = document.getElementById('complaintModalTitle');
                const modalContent = document.getElementById('complaintModalContent');
                
                modalTitle.textContent = `Complaint Details - ID: ${complaint.id}`;
                
                let html = `<p><strong>Complaint ID:</strong> ${complaint.id}</p>`;
                html += `<p><strong>Type:</strong> ${complaintCategories[complaint.type].title}</p>`;
                html += `<p><strong>Title:</strong> ${complaint.title}</p>`;
                html += `<p><strong>Submitted Date:</strong> ${complaint.date}</p>`;
                html += `<p><strong>Status:</strong> <span class="status status-${complaint.status}">${complaint.status}</span></p>`;
                html += `<p><strong>Priority:</strong> ${complaint.priority}</p>`;
                html += `<p><strong>Location:</strong> ${complaint.location}</p>`;
                
                html += '<h4>Description:</h4>';
                html += `<p>${complaint.description}</p>`;
                
                if (complaint.adminNotes) {
                    html += `<h4>Admin Notes:</h4><p>${complaint.adminNotes}</p>`;
                }
                
                if (complaint.resolutionDate) {
                    html += `<p><strong>Resolution Date:</strong> ${complaint.resolutionDate}</p>`;
                }
                
                modalContent.innerHTML = html;
                modal.style.display = 'flex';
            }
        }

        function formatFieldName(fieldName) {
            return fieldName
                .replace(/([A-Z])/g, ' $1')
                .replace(/^./, str => str.toUpperCase())
                .replace(/([A-Z])/g, ' $1')
                .replace(/([A-Z])/g, ' $1')
                .replace(/Id/g, 'ID')
                .replace(/Dob/g, 'Date of Birth')
                .replace(/Dod/g, 'Date of Death');
        }

        function updateAdminApplicationsTable() {
            const tableBody = document.getElementById('adminApplicationsTable');
            tableBody.innerHTML = '';
            
            if (applications.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No applications found.</td></tr>';
                return;
            }
            
            applications.forEach(application => {
                const row = document.createElement('tr');
                
                const statusClass = `status-${application.status.replace(' ', '-')}`;
                
                row.innerHTML = `
                    <td>${application.id}</td>
                    <td>${application.userName}</td>
                    <td>${getServiceDisplayName(application.serviceType)}</td>
                    <td>${application.date}</td>
                    <td><span class="status ${statusClass}">${application.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" data-id="${application.id}">View</button>
                        <button class="action-btn edit-btn" data-id="${application.id}">Edit</button>
                        <button class="action-btn delete-btn" data-id="${application.id}">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners for action buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    viewApplicationDetails(id);
                });
            });
            
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editApplication(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteApplication(id);
                });
            });
        }

        function updateAdminComplaintsTable() {
            const tableBody = document.getElementById('adminComplaintsTable');
            tableBody.innerHTML = '';
            
            if (complaints.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No complaints found.</td></tr>';
                return;
            }
            
            complaints.forEach(complaint => {
                const row = document.createElement('tr');
                
                const statusClass = `status-${complaint.status}`;
                
                row.innerHTML = `
                    <td>${complaint.id}</td>
                    <td>${complaint.userName}</td>
                    <td>${complaintCategories[complaint.type].title}</td>
                    <td>${complaint.title}</td>
                    <td>${complaint.date}</td>
                    <td><span class="status ${statusClass}">${complaint.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn view-btn" data-id="${complaint.id}" data-type="complaint">View</button>
                        <button class="action-btn edit-btn" data-id="${complaint.id}" data-type="complaint">Edit</button>
                        <button class="action-btn delete-btn" data-id="${complaint.id}" data-type="complaint">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners for action buttons
            document.querySelectorAll('.view-btn[data-type="complaint"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    viewComplaintDetails(id);
                });
            });
            
            document.querySelectorAll('.edit-btn[data-type="complaint"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editComplaint(id);
                });
            });
            
            document.querySelectorAll('.delete-btn[data-type="complaint"]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteComplaint(id);
                });
            });
        }

        function updateAdminUsersTable() {
            const tableBody = document.getElementById('adminUsersTable');
            tableBody.innerHTML = '';
            
            users.forEach(user => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td>${user.applications || 0}</td>
                    <td>${user.complaints || 0}</td>
                    <td><span class="status status-${user.status}">${user.status}</span></td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" data-id="${user.id}">Edit</button>
                        <button class="action-btn delete-btn" data-id="${user.id}">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners for action buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    editUser(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteUser(id);
                });
            });
        }

        function updateStats() {
            // Update home stats
            document.getElementById('total-applications').textContent = applications.length;
            document.getElementById('approved-applications').textContent = applications.filter(a => a.status === 'approved').length;
            document.getElementById('active-users').textContent = users.filter(u => u.status === 'active').length;
            document.getElementById('total-complaints').textContent = complaints.length;
            
            // Update admin stats
            document.getElementById('admin-total-applications').textContent = applications.length;
            document.getElementById('admin-approved-applications').textContent = applications.filter(a => a.status === 'approved').length;
            document.getElementById('admin-total-complaints').textContent = complaints.length;
            document.getElementById('admin-total-users').textContent = users.length;
        }

        function editApplication(id) {
            const application = applications.find(a => a.id === id);
            if (application) {
                const newStatus = prompt('Enter new status (pending, in progress, approved, rejected):', application.status);
                if (newStatus && ['pending', 'in progress', 'approved', 'rejected'].includes(newStatus.toLowerCase())) {
                    application.status = newStatus.toLowerCase();
                    
                    if (newStatus.toLowerCase() === 'approved' || newStatus.toLowerCase() === 'rejected') {
                        const notes = prompt('Enter notes for the applicant:');
                        if (notes) {
                            application.adminNotes = notes;
                        }
                    }
                    
                    saveData();
                    updateApplicationList();
                    updateAdminApplicationsTable();
                    updateStats();
                    alert('Application status updated successfully!');
                }
            }
        }

        function editComplaint(id) {
            const complaint = complaints.find(c => c.id === id);
            if (complaint) {
                const newStatus = prompt('Enter new status (open, investigation, resolved, closed):', complaint.status);
                if (newStatus && ['open', 'investigation', 'resolved', 'closed'].includes(newStatus.toLowerCase())) {
                    complaint.status = newStatus.toLowerCase();
                    
                    const notes = prompt('Enter update notes for the complainant:');
                    if (notes) {
                        complaint.adminNotes = notes;
                    }
                    
                    if (newStatus.toLowerCase() === 'resolved' || newStatus.toLowerCase() === 'closed') {
                        complaint.resolutionDate = new Date().toISOString().split('T')[0];
                    }
                    
                    saveData();
                    updateComplaintList();
                    updateAdminComplaintsTable();
                    updateStats();
                    alert('Complaint status updated successfully!');
                }
            }
        }

        function deleteApplication(id) {
            if (confirm('Are you sure you want to delete this application?')) {
                applications = applications.filter(a => a.id !== id);
                saveData();
                updateApplicationList();
                updateAdminApplicationsTable();
                updateStats();
                alert('Application deleted successfully!');
            }
        }

        function deleteComplaint(id) {
            if (confirm('Are you sure you want to delete this complaint?')) {
                complaints = complaints.filter(c => c.id !== id);
                saveData();
                updateComplaintList();
                updateAdminComplaintsTable();
                updateStats();
                alert('Complaint deleted successfully!');
            }
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                const newStatus = prompt('Enter new status (active, inactive):', user.status);
                if (newStatus && ['active', 'inactive'].includes(newStatus.toLowerCase())) {
                    user.status = newStatus.toLowerCase();
                    saveData();
                    updateAdminUsersTable();
                    alert('User status updated successfully!');
                }
            }
        }

        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user?')) {
                users = users.filter(u => u.id !== id);
                saveData();
                updateAdminUsersTable();
                updateStats();
                alert('User deleted successfully!');
            }
        }

        // 3D Animation using Three.js
        function init3DAnimation() {
            const container = document.getElementById('animation-container');
            if (!container) return;
            
            // Create scene
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // Create city buildings
            const buildings = [];
            const buildingColors = [0x3498db, 0x2ecc71, 0xe74c3c, 0xf39c12, 0x9b59b6];
            
            for (let i = 0; i < 15; i++) {
                const width = Math.random() * 2 + 1;
                const height = Math.random() * 3 + 2;
                const depth = Math.random() * 2 + 1;
                
                const geometry = new THREE.BoxGeometry(width, height, depth);
                const color = buildingColors[Math.floor(Math.random() * buildingColors.length)];
                const material = new THREE.MeshPhongMaterial({ color: color });
                const building = new THREE.Mesh(geometry, material);
                
                building.position.x = (Math.random() - 0.5) * 20;
                building.position.z = (Math.random() - 0.5) * 20;
                building.position.y = height / 2;
                
                scene.add(building);
                buildings.push(building);
            }
            
            // Add ground
            const groundGeometry = new THREE.PlaneGeometry(30, 30);
            const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x95a5a6, side: THREE.DoubleSide });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = Math.PI / 2;
            ground.position.y = -1;
            scene.add(ground);
            
            // Position camera
            camera.position.z = 15;
            camera.position.y = 5;
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                // Rotate buildings slightly
                buildings.forEach(building => {
                    building.rotation.y += 0.005;
                });
                
                // Rotate camera around the scene
                const time = Date.now() * 0.0005;
                camera.position.x = Math.sin(time) * 15;
                camera.position.z = Math.cos(time) * 15;
                camera.lookAt(0, 0, 0);
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', function() {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }
    </script>
</body>
</html>
